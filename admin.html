<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Mishell Boutique</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="admin-styles.css?v=1.6.0">

    <!-- Logo/Icon -->
    <link rel="icon" href="icon.svg" type="image/svg+xml">
    <meta name="theme-color" content="#D988B9">

    </head>
<body class="admin-page">

    <nav class="admin-navbar navbar navbar-expand-lg sticky-top">
        <div class="container-fluid">
            <a class="admin-brand navbar-brand" href="#"><span>Mishell</span></a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#adminNavbarContent" aria-controls="adminNavbarContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="adminNavbarContent">
                <ul class="nav nav-pills navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item"> <a href="#dashboard" class="nav-link active" data-bs-toggle="pill"><i class="bi bi-grid-1x2-fill me-1"></i> Dashboard</a> </li>
                    <li class="nav-item"> <a href="#pedidos-web" class="nav-link position-relative" data-bs-toggle="pill"><i class="bi bi-bag-check-fill me-1"></i> Pedidos Web <span class="badge bg-danger ms-1 badge-new-order" id="pedidos-web-count" style="display: none;">0</span></a> </li>
                    <li class="nav-item"> <a href="#productos" class="nav-link" data-bs-toggle="pill"><i class="bi bi-boxes me-1"></i> Productos</a> </li>
                    <li class="nav-item"> <a href="#ventas" class="nav-link" data-bs-toggle="pill"><i class="bi bi-receipt me-1"></i> Ventas</a> </li>
                    <li class="nav-item"> <a href="#apartados" class="nav-link" data-bs-toggle="pill"><i class="bi bi-calendar-check-fill me-1"></i> Apartados</a> </li>
                    <li class="nav-item"> <a href="#clientes" class="nav-link" data-bs-toggle="pill"><i class="bi bi-people-fill me-1"></i> Clientes</a> </li>
                    <li class="nav-item"> <a href="#repartidores" class="nav-link" data-bs-toggle="pill"><i class="bi bi-bicycle me-1"></i> Repartidores</a> </li>
                    <li class="nav-item"> <a href="#reportes" class="nav-link" data-bs-toggle="pill"><i class="bi bi-bar-chart-fill me-1"></i> Reportes</a> </li>
                    <li class="nav-item"> <a href="#finanzas" class="nav-link" data-bs-toggle="pill"><i class="bi bi-piggy-bank-fill me-1"></i> Finanzas</a> </li>
                    <li class="nav-item"> <a href="#categorias" class="nav-link" data-bs-toggle="pill"> <i class="bi bi-folder-fill me-1"></i> Categor√≠as </a> </li>
                    <li class="nav-item"> <a href="#proveedores" class="nav-link" data-bs-toggle="pill"> <i class="bi bi-building me-1"></i> Proveedores </a> </li>
                </ul>
                <a href="index.html" target="_blank" class="admin-logout d-flex align-items-center text-secondary text-decoration-none ms-lg-auto mt-2 mt-lg-0">
                     Cat√°logo <i class="bi bi-box-arrow-up-right ms-1"></i>
                 </a>
            </div>
        </div>
    </nav>

    <div class="toast-container position-fixed top-0 start-0 p-3">
      <div id="liveToast" class="toast align-items-center border-0" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="d-flex">
            <div class="toast-body" id="toast-body"> Mensaje. </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
      </div>
    </div>

    <main class="admin-main">
        <div class="tab-content">
            <div class="tab-pane fade show active" id="dashboard">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h1 class="h2 mb-0">
                        <i class="bi bi-speedometer2 me-2"></i>Dashboard
                    </h1>
                    <div class="text-muted small">
                        <i class="bi bi-calendar-event-fill"></i> Hoy: <span id="dashboard-date"></span>
                    </div>
                </div>

                <!-- Tarjetas de Resumen Principal -->
                <div class="row g-4 mb-4">
                    <div class="col-md-3 col-sm-6">
                        <div class="dashboard-card card-ventas">
                            <div class="card-icon">
                                <i class="bi bi-wallet2"></i>
                            </div>
                            <div class="card-content">
                                <h6 class="card-label">Ventas Hoy</h6>
                                <p class="card-value" id="db-ventas-hoy">$0</p>
                                <small class="card-subtitle" id="db-ventas-count">0 ventas</small>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-3 col-sm-6">
                        <div class="dashboard-card card-productos">
                            <div class="card-icon">
                                <i class="bi bi-box-seam-fill"></i>
                            </div>
                            <div class="card-content">
                                <h6 class="card-label">Productos Totales</h6>
                                <p class="card-value" id="db-total-productos">0</p>
                                <small class="card-subtitle" id="db-productos-disponibles">0 disponibles</small>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-3 col-sm-6">
                        <div class="dashboard-card card-stock" style="cursor: pointer;" data-bs-toggle="modal" data-bs-target="#bajoStockModal">
                            <div class="card-icon">
                                <i class="bi bi-exclamation-triangle-fill"></i>
                            </div>
                            <div class="card-content">
                                <h6 class="card-label">Bajo Stock</h6>
                                <p class="card-value" id="db-bajo-stock">0</p>
                                <small class="card-subtitle">2 unidades o menos</small>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-3 col-sm-6">
                        <div class="dashboard-card card-apartados">
                            <div class="card-icon">
                                <i class="bi bi-clock-history"></i>
                            </div>
                            <div class="card-content">
                                <h6 class="card-label">Apartados Activos</h6>
                                <p class="card-value" id="db-apartados-vencer">0</p>
                                <small class="card-subtitle" id="db-apartados-total-saldo">$0 pendiente</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- M√©tricas Secundarias Compactas -->
                <div class="card mb-4">
                    <div class="card-body p-3">
                        <div class="row g-3 text-center">
                            <div class="col-6 col-md-3">
                                <div class="d-flex flex-column align-items-center">
                                    <div class="icon-badge bg-info mb-2">
                                        <i class="bi bi-bag-check"></i>
                                    </div>
                                    <small class="text-muted mb-1">Pedidos Web</small>
                                    <h6 class="mb-0 fw-bold" id="db-pedidos-web">0</h6>
                                </div>
                            </div>
                            <div class="col-6 col-md-3">
                                <div class="d-flex flex-column align-items-center">
                                    <div class="icon-badge bg-success mb-2">
                                        <i class="bi bi-people"></i>
                                    </div>
                                    <small class="text-muted mb-1">Clientes</small>
                                    <h6 class="mb-0 fw-bold" id="db-total-clientes">0</h6>
                                </div>
                            </div>
                            <div class="col-6 col-md-3">
                                <div class="d-flex flex-column align-items-center">
                                    <div class="icon-badge bg-warning mb-2">
                                        <i class="bi bi-tags"></i>
                                    </div>
                                    <small class="text-muted mb-1">Promociones</small>
                                    <h6 class="mb-0 fw-bold" id="db-promociones-activas">0</h6>
                                </div>
                            </div>
                            <div class="col-6 col-md-3">
                                <div class="d-flex flex-column align-items-center">
                                    <div class="icon-badge bg-danger mb-2">
                                        <i class="bi bi-truck"></i>
                                    </div>
                                    <small class="text-muted mb-1">Repartidores</small>
                                    <h6 class="mb-0 fw-bold" id="db-total-repartidores">0</h6>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Secci√≥n: An√°lisis de Datos -->
                <div class="mb-3">
                    <h5 class="text-muted fw-light"><i class="bi bi-bar-chart-line me-2"></i>An√°lisis de Datos</h5>
                </div>
                <div class="row g-4 mb-4">
                    <div class="col-lg-8">
                        <div class="card shadow-sm">
                            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                                <h5 class="mb-0"><i class="bi bi-graph-up me-2"></i>Tendencia de Ventas</h5>
                                <div class="btn-group btn-group-sm" role="group">
                                    <input type="radio" class="btn-check" name="chart-period" id="chart-7days" autocomplete="off" checked>
                                    <label class="btn btn-outline-primary" for="chart-7days">7 d√≠as</label>

                                    <input type="radio" class="btn-check" name="chart-period" id="chart-30days" autocomplete="off">
                                    <label class="btn btn-outline-primary" for="chart-30days">30 d√≠as</label>

                                    <input type="radio" class="btn-check" name="chart-period" id="chart-6months" autocomplete="off">
                                    <label class="btn btn-outline-primary" for="chart-6months">6 meses</label>
                                </div>
                            </div>
                            <div class="card-body">
                                <canvas id="ventasChart" height="80"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-4">
                        <div class="card h-100 shadow-sm">
                            <div class="card-header bg-white">
                                <h5 class="mb-0"><i class="bi bi-trophy me-2"></i>Top Productos</h5>
                            </div>
                            <div class="card-body">
                                <canvas id="topProductosChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Secci√≥n: Alertas y Actividad -->
                <div class="mb-3">
                    <h5 class="text-muted fw-light"><i class="bi bi-bell me-2"></i>Alertas y Actividad</h5>
                </div>
                <div class="row g-4">
                    <div class="col-lg-6">
                        <div class="card shadow-sm">
                            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                                <h5 class="mb-0"><i class="bi bi-exclamation-circle me-2"></i>Stock Cr√≠tico</h5>
                                <a href="#productos" data-bs-toggle="pill" class="btn btn-sm btn-outline-primary">Ver todos</a>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0">
                                        <thead>
                                            <tr>
                                                <th>Producto</th>
                                                <th class="text-center">Stock</th>
                                                <th class="text-end">Acci√≥n</th>
                                            </tr>
                                        </thead>
                                        <tbody id="db-tabla-stock-critico">
                                            <tr>
                                                <td colspan="3" class="text-center text-muted py-3">
                                                    Cargando...
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-6">
                        <div class="card shadow-sm">
                            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                                <h5 class="mb-0"><i class="bi bi-clock-history me-2"></i>Actividad Reciente</h5>
                                <a href="#ventas" data-bs-toggle="pill" class="btn btn-sm btn-outline-primary">Ver todas</a>
                            </div>
                            <div class="card-body p-0">
                                <div class="activity-list" id="db-actividad-reciente">
                                    <div class="text-center text-muted py-3">
                                        Cargando actividad...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="tab-pane fade" id="pedidos-web">
                <h1 class="h2 mb-4"><i class="bi bi-globe me-2"></i>Pedidos desde la Web</h1>
                <div class="card">
                    <div class="card-header bg-white border-0 pt-3">
                        <h3 class="h5 mb-0">Pedidos Pendientes</h3>
                    </div>
                    <div class="card-body p-0">
                        <div id="web-orders-container" class="p-3">
                            <div class="text-center text-muted py-5" id="loading-web-orders">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Cargando...</span>
                                </div>
                                <p class="mt-2">Cargando pedidos...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="productos"> 
                <div class="d-flex justify-content-between align-items-center mb-3"> 
                    <h1 class="h2 mb-0">Productos</h1> 
                    <div class="btn-group"> 
                        <button type="button" id="toggle-inventory-view-btn" class="btn btn-sm btn-outline-secondary active"><i class="bi bi-list-ul me-1"></i><span class="d-none d-md-inline"> Inventario</span></button> 
                        <button type="button" id="toggle-form-view-btn" class="btn btn-sm btn-outline-secondary"><i class="bi bi-plus-circle me-1"></i><span class="d-none d-md-inline"> Agregar/Editar</span></button> 
                    </div> 
                </div>
                
                <div class="row align-items-center mb-2 variation-row d-none" id="variation-template">
                    <div class="col-md-4"> <input type="text" class="form-control form-control-sm" name="variation_talla[]" placeholder="Talla"> </div>
                    <div class="col-md-4"> <input type="text" class="form-control form-control-sm" name="variation_color[]" placeholder="Color"> </div>
                    <div class="col-md-3"> <input type="number" class="form-control form-control-sm" name="variation_stock[]" min="0" value="1" placeholder="Stock"> </div>
                    <div class="col-md-1 text-end"> <button type="button" class="btn btn-sm btn-outline-danger remove-variation-btn p-1"> <i class="bi bi-trash3"></i> </button> </div>
                </div>
                
                <div id="form-view" style="display: none;"> 
                    <div class="card"> 
                        <div class="card-header bg-white border-0 pt-3"><h3 class="h5 mb-0" id="product-form-title">Formulario Producto</h3></div> 
                        <div class="card-body"> 
                            <form id="form-producto"> 
                                <input type="hidden" id="producto-id"> 
                                <div class="row"> 
                                    <div class="col-md-6 mb-3"> <label for="nombre" class="form-label">Nombre:</label> <input type="text" class="form-control" id="nombre" required> </div> 
                                    <div class="col-md-3 mb-3"> <label for="codigo" class="form-label">C√≥digo:</label> <input type="text" class="form-control" id="codigo" placeholder="Autogenerado" readonly disabled> </div> 
                                    <div class="col-md-3 mb-3"> <label for="proveedor-producto" class="form-label">Proveedor:</label> 
                                        <div class="input-group"> 
                                            <input type="text" class="form-control" id="proveedor-producto" placeholder="Seleccionar..." readonly data-bs-toggle="modal" data-bs-target="#searchSupplierModal" style="cursor: pointer;"> 
                                            <input type="hidden" id="proveedor-producto-id"> 
                                            <button class="btn btn-outline-secondary add-supplier-btn" type="button" data-bs-toggle="modal" data-bs-target="#addSupplierModal" title="Agregar">+</button> 
                                        </div> 
                                    </div> 
                                </div> 
                                <div class="mb-3"> <label for="descripcion" class="form-label">Descripci√≥n:</label> <textarea class="form-control" id="descripcion" rows="2"></textarea> </div> 
                                <div class="mb-3"> <label for="categoria-producto" class="form-label">Categor√≠a:</label> <select class="form-select" id="categoria-producto"><option value="">Selecciona...</option></select> </div> 
                                <hr class="my-4"> 
                                <h5 class="mb-3">Precios</h5> 
                                <div class="row"> 
                                    <div class="col-md-4 mb-3"> <label for="costo-compra" class="form-label">Costo ($):</label> <input type="number" class="form-control" id="costo-compra" step="0.01" min="0" required> </div> 
                                    <div class="col-md-4 mb-3"> <label for="precio-detal" class="form-label">P. Detal ($):</label> <input type="number" class="form-control" id="precio-detal" step="0.01" min="0" required> <small id="margen-detal-info" class="form-text text-muted"></small> </div> 
                                    <div class="col-md-4 mb-3"> <label for="precio-mayor" class="form-label">P. Mayor ($):</label> <input type="number" class="form-control" id="precio-mayor" step="0.01" min="0"> <small id="margen-mayor-info" class="form-text text-muted"></small> </div> 
                                </div> 
                                <hr class="my-4"> 
                                <h5 class="mb-3">Variaciones</h5> 
                                <div id="variaciones-container"> </div> 
                                <button type="button" id="add-variation-btn" class="btn btn-sm btn-outline-primary mt-2"> <i class="bi bi-plus-lg"></i> A√±adir</button> 
                                <hr class="my-4"> 
                                <div class="row"> 
                                    <div class="col-md-8 mb-3"> <label for="imagen" class="form-label">Fotos:</label> <input type="file" class="form-control" id="imagen" accept="image/*" multiple> <small class="text-muted" id="image-upload-label">La 1ra ser√° la principal. Si editas y no subes una nueva, se mantendr√° la anterior.</small> </div> 
                                    <div class="col-md-4 d-flex align-items-center"> 
                                        <div class="form-check form-switch fs-5 w-100"> <input class="form-check-input" type="checkbox" role="switch" id="visibilidad" checked> <label class="form-check-label" for="visibilidad">Visible</label> </div> 
                                    </div> 
                                </div> 
                                <hr class="my-4"> 
                                <button type="submit" class="btn btn-primary" id="btn-save-product"> <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true" style="display: none;"></span> <span class="save-text">Guardar</span> </button> 
                                <button type="button" id="btn-clear-product-form" class="btn btn-outline-secondary ms-2">Limpiar</button> 
                            </form> 
                        </div> 
                    </div> 
                </div> 
                
                <!-- ‚úÖ INVENTARIO MEJORADO CON FILTROS -->
                <div id="inventory-view"> 
                    <!-- FILTROS MEJORADOS -->
                    <div class="row mb-3 g-2">
                        <div class="col-md-6">
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-search"></i></span>
                                <input type="search" id="search-inventory" class="form-control" placeholder="Buscar por nombre o c√≥digo...">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <select id="filter-category-inventory" class="form-select">
                                <option value="">Todas las Categor√≠as</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <button type="button" id="clear-filters-inventory" class="btn btn-outline-secondary w-100">
                                <i class="bi bi-x-circle me-1"></i>Limpiar
                            </button>
                        </div>
                    </div>
                    
                    <!-- TABLA CON COLUMNA DE CATEGOR√çA -->
                    <div class="card">
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-hover align-middle mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Foto</th>
                                            <th>Nombre</th>
                                            <th>Categor√≠a</th>
                                            <th>Variaciones</th>
                                            <th>P. Detal</th>
                                            <th>P. Mayor</th>
                                            <th>Stock</th>
                                            <th>Promoci√≥n</th>
                                            <th>Estado</th>
                                            <th>Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody id="lista-inventario-productos">
                                        <tr id="empty-inventory-row">
                                            <td colspan="10" class="text-center text-muted p-4">Cargando...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div> 
                </div> 
            </div>
            
            <div class="tab-pane fade" id="ventas"> 
                <div class="d-flex justify-content-between align-items-center mb-3"> 
                    <h1 class="h2 mb-0">Ventas</h1> 
                    <div class="btn-group"> 
                        <button type="button" id="toggle-sales-form-view-btn" class="btn btn-sm btn-outline-secondary active"> <i class="bi bi-plus-circle me-1"></i><span class="d-none d-md-inline"> Registrar</span></button> 
                        <button type="button" id="toggle-sales-list-view-btn" class="btn btn-sm btn-outline-secondary"> <i class="bi bi-list-check me-1"></i><span class="d-none d-md-inline"> Historial</span></button> 
                    </div> 
                </div> 
                
                <div id="sales-form-view"> 
                    <div class="card"> 
                        <div class="card-header bg-white border-0 pt-3"><h3 class="h5 mb-0">Registrar Venta</h3></div> 
                        <div class="card-body"> 
                            <form id="form-venta"> 
                                <input type="hidden" id="venta-cliente-id"> 
                                <div class="row align-items-end">
                                    <div class="col-md-5 mb-3"> <label for="venta-cliente" class="form-label">Cliente:</label>
                                        <div class="input-group">
                                            <input type="text" id="venta-cliente" class="form-control" placeholder="Seleccionar..." readonly data-bs-toggle="modal" data-bs-target="#searchClientModal" style="cursor: pointer;">
                                            <button class="btn btn-outline-secondary add-client-btn" type="button" data-bs-toggle="modal" data-bs-target="#addClientModal" title="Agregar">+</button>
                                        </div>
                                        <div class="row mt-2 gx-2">
                                            <div class="col-6"> <input type="text" id="venta-cliente-celular" class="form-control form-control-sm client-info-display" placeholder="Celular" readonly disabled> </div>
                                            <div class="col-6"> <input type="text" id="venta-cliente-direccion" class="form-control form-control-sm client-info-display" placeholder="Direcci√≥n" readonly disabled> </div>
                                        </div>
                                    </div>
                                    <div class="col-md-2 mb-3"> <label for="tipo-venta-select" class="form-label">Tipo Venta:</label> <select id="tipo-venta-select" name="tipo-venta" class="form-select form-select-sm"> <option value="detal" selected>Detal</option> <option value="mayorista">Mayorista</option> <option value="apartado">Apartado</option> </select> </div>
                                    <div class="col-md-3 mb-3"> <label for="tipo-entrega-select" class="form-label">Tipo Entrega:</label> <select id="tipo-entrega-select" name="tipo-entrega" class="form-select form-select-sm"> <option value="tienda" selected>Recoge Tienda</option> <option value="domicilio">Domicilio</option> </select> </div>
                                    <div class="col-md-2 mb-3 apartado-fecha-field" style="display: none;">
                                        <label for="apartado-fecha-max" class="form-label">Vence:</label>
                                        <input type="date" id="apartado-fecha-max" class="form-control form-control-sm">
                                    </div>
                                </div> 
                                <div class="row delivery-fields">
                                    <div class="col-md-6 mb-3"> <label for="venta-repartidor" class="form-label">Repartidor:</label> <select id="venta-repartidor" class="form-select"></select> </div>
                                    <div class="col-md-6 mb-3"> <label for="costo-ruta" class="form-label">Costo Ruta ($):</label> <input type="number" id="costo-ruta" class="form-control" value="0" step="100"> </div>
                                </div> 
                                <label for="venta-producto" class="form-label">Buscar Producto:</label> 
                                <input type="text" id="venta-producto" class="form-control" placeholder="Clic para buscar..." readonly data-bs-toggle="modal" data-bs-target="#searchProductModal" style="cursor: pointer;"> 
                                <table class="table my-3"> 
                                    <thead><tr><th>Producto</th><th>Cant.</th><th>Precio</th><th>Total</th><th></th></tr></thead> 
                                    <tbody id="venta-carrito"></tbody> 
                                </table> 
                                <hr> 
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <div class="form-check form-switch d-flex align-items-center justify-content-between">
                                                <label class="form-check-label" for="venta-whatsapp">Pedido WhatsApp</label>
                                                <input class="form-check-input ms-2" type="checkbox" id="venta-whatsapp" disabled>
                                            </div>
                                            <small class="d-block text-muted">Se activa autom√°ticamente desde pedidos web</small>
                                        </div>
                                        <div class="mb-3 delivery-fields">
                                            <div class="form-check form-switch d-flex align-items-center justify-content-between">
                                                <label class="form-check-label" for="ruta-pagada-transferencia">Ruta pagada por Transferencia</label>
                                                <input class="form-check-input ms-2" type="checkbox" id="ruta-pagada-transferencia">
                                            </div>
                                        </div>
                                        <label for="venta-observaciones" class="form-label">Observaciones:</label>
                                        <textarea id="venta-observaciones" class="form-control" rows="2"></textarea>
                                    </div> 
                                    <div class="col-md-6"> 
                                        <div class="row"> 
                                            <div class="col-7"> 
                                                <label for="venta-descuento" class="form-label">Descuento:</label> 
                                                <input type="number" id="venta-descuento" class="form-control" value="0"> 
                                            </div> 
                                            <div class="col-5"> 
                                                <label class="form-label">&nbsp;</label> 
                                                <select class="form-select" id="venta-descuento-tipo"> <option value="fijo">$ Fijo</option> <option value="porcentaje">%</option> </select> 
                                            </div> 
                                        </div> 
                                        <label class="form-label mt-3">Pago:</label> 
                                        <div class="input-group mb-2"> <span class="input-group-text">Efectivo $</span> <input type="number" id="pago-efectivo" class="form-control" value="0"> </div> 
                                        <div class="input-group mb-3"> <span class="input-group-text">Transf. $</span> <input type="number" id="pago-transferencia" class="form-control" value="0"> </div> 
                                        <h4 class="text-end">Total (+ Ruta): <span id="venta-total" class="text-primary">$0.00</span></h4> 
                                        <button type="submit" class="btn btn-primary w-100 mt-2">Registrar Venta</button> 
                                    </div> 
                                </div> 
                            </form> 
                        </div> 
                    </div> 
                </div> 
                
                <div id="sales-list-view">
                    <div class="card">
                        <div class="card-header bg-white border-0 pt-3">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h3 class="h5 mb-0">Historial</h3>
                            </div>
                            <div class="row g-2">
                                <div class="col-md-3">
                                    <label for="filtro-fecha-ventas" class="form-label small">Filtrar por fecha:</label>
                                    <input type="date" id="filtro-fecha-ventas" class="form-control form-control-sm">
                                </div>
                                <div class="col-md-3 d-flex align-items-end">
                                    <button type="button" id="btn-limpiar-filtro-ventas" class="btn btn-sm btn-outline-secondary">
                                        <i class="bi bi-x-circle"></i> Limpiar
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="card-body p-0"><div class="table-responsive"><table class="table table-hover align-middle mb-0"><thead class="table-light"> <tr><th>Fecha</th><th>Cliente</th><th>Tipo</th><th>Total</th><th>Pago</th><th>Repartidor</th><th>Estado</th><th>Acciones</th></tr> </thead><tbody id="lista-ventas-anteriores"> <tr id="empty-sales-row"><td colspan="8" class="text-center text-muted p-4">Cargando...</td></tr> </tbody></table></div></div>
                    </div>
                </div> 
            </div>
            
            <div class="tab-pane fade" id="apartados"> <h1 class="h2">Apartados</h1> <div class="card"><div class="card-header bg-white border-0 pt-3"><h3 class="h5 mb-0">Pendientes</h3></div><div class="card-body p-0"><div class="table-responsive"><table class="table table-hover align-middle mb-0"><thead class="table-light"><tr><th>Cliente</th><th>Total</th><th>Abonado</th><th>Saldo</th><th>Vence</th><th>Acciones</th></tr></thead><tbody id="lista-apartados"><tr><td colspan="6" class="text-center text-muted">Cargando...</td></tr></tbody></table></div></div></div> </div>
            <!--apartados-->
            <div class="modal fade" id="abonoApartadoModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Registrar Abono</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-light mb-3">
                    <h6 class="mb-2"><strong>Cliente:</strong> <span id="abono-cliente-nombre"></span></h6>
                    <div class="row text-center mt-3">
                        <div class="col-4">
                            <small class="text-muted d-block">Total</small>
                            <strong id="abono-total">$0</strong>
                        </div>
                        <div class="col-4">
                            <small class="text-muted d-block">Abonado</small>
                            <strong class="text-success" id="abono-abonado">$0</strong>
                        </div>
                        <div class="col-4">
                            <small class="text-muted d-block">Saldo</small>
                            <strong class="text-danger" id="abono-saldo">$0</strong>
                        </div>
                    </div>
                </div>
                
                <form id="form-abono-apartado">
                    <input type="hidden" id="abono-apartado-id">
                    <input type="hidden" id="abono-saldo-actual">
                    
                    <div class="mb-3">
                        <label for="abono-monto" class="form-label">Monto a Abonar ($)</label>
                        <input type="number" 
                               class="form-control form-control-lg text-center" 
                               id="abono-monto" 
                               min="1" 
                               step="0.01"
                               required 
                               autofocus>
                        <small class="text-muted" id="abono-helper"></small>
                    </div>
                    
                    <div class="mb-3">
                        <label for="abono-metodo-pago" class="form-label">M√©todo de Pago</label>
                        <select class="form-select" id="abono-metodo-pago" required>
                            <option value="Efectivo">Efectivo</option>
                            <option value="Transferencia">Transferencia</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="abono-observaciones" class="form-label">Observaciones (Opcional)</label>
                        <textarea class="form-control" id="abono-observaciones" rows="2"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="submit" form="form-abono-apartado" class="btn btn-success">
                    <i class="bi bi-cash-coin me-1"></i> Registrar Abono
                </button>
            </div>
        </div>
    </div>
</div>

            <div class="modal fade" id="verApartadoModal" tabindex="-1">
                <div class="modal-dialog modal-dialog-centered modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Detalle del Apartado</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <p><strong>Cliente:</strong> <span id="detalle-cliente-nombre"></span></p>
                                    <p><strong>Estado:</strong> <span id="detalle-estado" class="badge"></span></p>
                                    <p><strong>Fecha de Vencimiento:</strong> <span id="detalle-vencimiento"></span></p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong>Total:</strong> <span id="detalle-total"></span></p>
                                    <p><strong>Abonado:</strong> <span id="detalle-abonado" class="text-success"></span></p>
                                    <p><strong>Saldo Pendiente:</strong> <span id="detalle-saldo" class="text-danger"></span></p>
                                </div>
                            </div>

                            <h6 class="border-top pt-3">Historial de Pagos</h6>
                            <div class="table-responsive">
                                <table class="table table-sm table-hover">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Fecha</th>
                                            <th>Monto</th>
                                            <th>M√©todo</th>
                                            <th>Observaciones</th>
                                        </tr>
                                    </thead>
                                    <tbody id="detalle-historial-pagos">
                                        <tr><td colspan="4" class="text-center text-muted">No hay pagos registrados</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                        </div>
                    </div>
                </div>
            </div>
            <!--apartados-->
            <div class="tab-pane fade" id="clientes"> <h1 class="h2">Clientes</h1> <div class="card"><div class="card-header bg-white border-0 pt-3 d-flex justify-content-between align-items-center"><h3 class="h5 mb-0">Lista</h3><button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#addClientModal"><i class="bi bi-plus-lg"></i> Nuevo</button></div><div class="card-body p-0"><div class="table-responsive"><table class="table table-hover align-middle mb-0"><thead class="table-light"><tr><th>Nombre</th><th>C√©dula</th><th>WhatsApp</th><th>Direcci√≥n</th><th>√öltima Compra</th><th>Acciones</th></tr></thead><tbody id="lista-clientes"><tr><td colspan="6" class="text-center text-muted">Cargando...</td></tr></tbody></table></div></div></div> </div>
            
            <div class="tab-pane fade" id="repartidores"> 
                <div class="d-flex justify-content-between align-items-center mb-3"> 
                    <h1 class="h2 mb-0">Repartidores</h1> 
                    <div class="btn-group"> 
                        <button type="button" id="toggle-delivery-today-btn" class="btn btn-sm btn-outline-secondary active"> <i class="bi bi-bicycle me-1"></i><span class="d-none d-md-inline"> Hoy</span></button> 
                        <button type="button" id="toggle-delivery-history-btn" class="btn btn-sm btn-outline-secondary"> <i class="bi bi-calendar-week me-1"></i><span class="d-none d-md-inline"> Historial</span></button> 
                    </div> 
                </div> 
                
                <div id="delivery-today-view"> 
                    <div class="card"><div class="card-header bg-white border-0 pt-3 d-flex justify-content-between align-items-center"><h3 class="h5 mb-0">Liquidaci√≥n Hoy</h3><button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#addRepartidorModal"><i class="bi bi-plus-lg"></i> Nuevo</button></div><div class="card-body p-0"><div class="table-responsive"><table class="table table-hover align-middle mb-0"><thead><tr><th>Repartidor</th><th># Ent.</th><th>Efec. Recibido</th><th>Rutas ($)</th><th>Rutas Transf. ($)</th><th>Efec. a Entregar ($)</th><th>Efec. Entregado ($)</th><th>Saldo ($)</th><th>Acciones</th></tr></thead><tbody id="lista-repartidores"><tr><td colspan="9" class="text-center text-muted">Cargando...</td></tr></tbody></table></div></div></div> 
                </div> 
                
                <div id="delivery-history-view"> 
                    <div class="card"><div class="card-header bg-white border-0 pt-3"><h3 class="h5 mb-0">Historial</h3></div><div class="card-body"><form id="form-filter-delivery-history" class="mb-3"><div class="row"><div class="col-md-4"><label for="history-repartidor" class="form-label">Repartidor:</label><select id="history-repartidor" class="form-select"></select></div><div class="col-md-3"><label for="history-desde" class="form-label">Desde:</label><input type="date" id="history-desde" class="form-control"></div><div class="col-md-3"><label for="history-hasta" class="form-label">Hasta:</label><input type="date" id="history-hasta" class="form-control"></div><div class="col-md-2 d-flex align-items-end"><button type="submit" class="btn btn-primary w-100">Filtrar</button></div></div></form><div class="table-responsive"><table class="table table-hover align-middle mb-0"><thead class="table-light"><tr><th>Fecha</th><th>Repartidor</th><th>Efec. Esperado</th><th>Efec. Entregado</th><th>Diferencia</th></tr></thead><tbody id="lista-historial-repartidores"><tr><td colspan="5" class="text-center text-muted">Filtra.</td></tr></tbody></table></div></div></div> 
                </div> 
            </div>
            
            <div class="tab-pane fade" id="reportes">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h1 class="h2 mb-0"><i class="bi bi-file-earmark-bar-graph me-2"></i>Reportes</h1>
                    <button type="button" id="btn-imprimir-reporte" class="btn btn-outline-secondary" style="display: none;">
                        <i class="bi bi-printer"></i> Imprimir
                    </button>
                </div>

                <div class="card">
                    <div class="card-header bg-white">
                        <h5 class="mb-0">Generar Reporte</h5>
                    </div>
                    <div class="card-body">
                        <form id="form-reporte">
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <label for="reporte-tipo" class="form-label">Tipo de Reporte:</label>
                                    <select id="reporte-tipo" class="form-select">
                                        <option value="">Seleccionar...</option>
                                        <option value="ventas">üìä Ventas</option>
                                        <option value="utilidad">üí∞ Utilidad</option>
                                        <option value="mas-vendidos">üèÜ M√°s Vendidos</option>
                                        <option value="repartidor">üö¥ Por Repartidor</option>
                                        <option value="apartados">üìÖ Apartados</option>
                                        <option value="descuentos">üéÅ Descuentos</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label for="reporte-desde" class="form-label">Desde:</label>
                                    <input type="date" id="reporte-desde" class="form-control" required>
                                </div>
                                <div class="col-md-3">
                                    <label for="reporte-hasta" class="form-label">Hasta:</label>
                                    <input type="date" id="reporte-hasta" class="form-control" required>
                                </div>
                                <div class="col-md-2 d-flex align-items-end">
                                    <button type="submit" class="btn btn-primary w-100">
                                        <i class="bi bi-clipboard-data-fill"></i> Generar
                                    </button>
                                </div>
                            </div>

                            <!-- Filtro adicional para repartidores -->
                            <div id="reporte-repartidor-filter" class="row g-3 mt-2" style="display: none;">
                                <div class="col-md-4">
                                    <label for="reporte-repartidor-select" class="form-label">Seleccionar Repartidor:</label>
                                    <select id="reporte-repartidor-select" class="form-select">
                                        <option value="">Todos los repartidores</option>
                                    </select>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- √Årea de resultados -->
                <div id="area-reporte" class="mt-4">
                    <div class="text-center text-muted py-5">
                        <i class="bi bi-file-earmark-text" style="font-size: 3rem;"></i>
                        <p class="mt-3">Selecciona un tipo de reporte y las fechas para generar</p>
                    </div>
                </div>
            </div>
            
            <div class="tab-pane fade" id="finanzas"> 
                <div class="d-flex justify-content-between align-items-center mb-3"> 
                    <h1 class="h2 mb-0">Finanzas</h1> 
                    <div class="btn-group"> 
                        <button type="button" class="btn btn-sm btn-outline-success" data-bs-toggle="modal" data-bs-target="#addIncomeModal"> <i class="bi bi-plus-circle"></i><span class="d-none d-md-inline"> Ingreso</span></button> 
                        <button type="button" class="btn btn-sm btn-outline-danger" data-bs-toggle="modal" data-bs-target="#addExpenseModal"> <i class="bi bi-dash-circle"></i><span class="d-none d-md-inline"> Gasto</span></button> 
                        <button type="button" id="toggle-closing-today-btn" class="btn btn-sm btn-outline-secondary active"> <i class="bi bi-box-arrow-in-down me-1"></i><span class="d-none d-md-inline"> Cierre Hoy</span></button> 
                        <button type="button" id="toggle-closing-history-btn" class="btn btn-sm btn-outline-secondary"> <i class="bi bi-calendar-week me-1"></i><span class="d-none d-md-inline"> Historial</span></button> 
                    </div> 
                </div> 
                
                <div id="closing-today-view"> 
                    <div class="card"><div class="card-header bg-white border-0 pt-3"><h3 class="h5 mb-0">Cierre Diario</h3></div><div class="card-body"><form id="form-cierre-caja"><div class="row"><div class="col-md-3"><label class="form-label">Ventas Efectivo:</label><input type="text" class="form-control" id="caja-efectivo" value="$0" readonly></div><div class="col-md-3"><label class="form-label">Abonos Efectivo:</label><input type="text" class="form-control" id="caja-abonos-efectivo" value="$0" readonly></div><div class="col-md-3"><label class="form-label">Recibido Repart.:</label><input type="text" class="form-control" id="caja-recibido-repartidores" value="$0" readonly></div><div class="col-md-3"><label for="caja-egresos" class="form-label">Gastos ($):</label><input type="number" class="form-control" id="caja-egresos" value="0" step="0.01"></div></div><div class="row mt-3"><div class="col-md-9"><label for="caja-observaciones" class="form-label">Observaciones:</label><input type="text" class="form-control" id="caja-observaciones"></div><div class="col-md-3"><label class="form-label">Total Caja:</label><input type="text" class="form-control fw-bold" id="caja-total" value="$0" readonly></div></div><hr><p class="text-muted small">Nota: Transferencias no afectan efectivo.</p><button type="submit" class="btn btn-primary mt-3">Realizar Cierre</button></form></div></div> 
                </div> 
                
                <div id="closing-history-view"> 
                    <div class="card"><div class="card-header bg-white border-0 pt-3"><h3 class="h5 mb-0">Historial</h3></div><div class="card-body p-0"><div class="table-responsive"><table class="table table-hover align-middle mb-0"><thead class="table-light"><tr><th>Fecha</th><th>Ventas Efec.</th><th>Abonos Efec.</th><th>Recibido Repart.</th><th>Gastos</th><th>Total Caja</th><th>Obs.</th></tr></thead><tbody id="lista-historial-cierres"><tr><td colspan="7" class="text-center text-muted">Cargando...</td></tr></tbody></table></div></div></div> 
                </div> 
            </div>
            
            <div class="tab-pane fade" id="categorias"> <h1 class="h2">Categor√≠as</h1> <div class="row"><div class="col-md-6"><div class="card"><div class="card-header bg-white border-0 pt-3"> <h3 class="h5 mb-0">Agregar</h3> </div><div class="card-body"><form id="form-categoria"><div class="mb-3"> <label for="nombre-categoria" class="form-label">Nombre:</label> <input type="text" id="nombre-categoria" class="form-control" required> </div><button type="submit" class="btn btn-primary">Guardar</button></form></div></div></div><div class="col-md-6"><div class="card"><div class="card-header bg-white border-0 pt-3"> <h3 class="h5 mb-0">Existentes</h3> </div><div class="card-body p-0"><ul class="list-group list-group-flush" id="lista-categorias"><li class="list-group-item text-muted" id="loading-categories">Cargando...</li></ul></div></div></div></div> </div>
            
            <div class="tab-pane fade" id="proveedores"> <h1 class="h2">Proveedores</h1> <div class="card"><div class="card-header bg-white border-0 pt-3 d-flex justify-content-between align-items-center"><h3 class="h5 mb-0">Lista</h3><button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#addSupplierModal"><i class="bi bi-plus-lg"></i> Nuevo</button></div><div class="card-body p-0"><div class="table-responsive"><table class="table table-hover align-middle mb-0"><thead><tr><th>Nombre</th><th>Contacto</th><th>Tel√©fono</th><th>Acciones</th></tr></thead><tbody id="lista-proveedores-tabla"><tr><td colspan="4" class="text-center text-muted">Cargando...</td></tr></tbody></table></div></div></div> </div>
        </div>
    </main>

    <div class="modal fade" id="addClientModal" tabindex="-1"> <div class="modal-dialog"> <div class="modal-content"> <div class="modal-header"> <h1 class="modal-title fs-5">Agregar Cliente</h1> <button type="button" class="btn-close" data-bs-dismiss="modal"></button> </div> <div class="modal-body"> <form id="form-add-client"> <div class="mb-3"> <label for="new-client-cedula" class="form-label">C√©dula:</label> <input type="text" class="form-control" id="new-client-cedula"> </div> <div class="mb-3"> <label for="new-client-nombre" class="form-label">Nombre:</label> <input type="text" class="form-control" id="new-client-nombre" required> </div> <div class="mb-3"> <label for="new-client-celular" class="form-label">Celular:</label> <input type="tel" class="form-control" id="new-client-celular" required> </div> <div class="mb-3"> <label for="new-client-direccion" class="form-label">Direcci√≥n:</label> <input type="text" class="form-control" id="new-client-direccion"> </div> </form> </div> <div class="modal-footer"> <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button> <button type="submit" form="form-add-client" class="btn btn-primary">Guardar</button> </div> </div> </div> </div>
    <div class="modal fade" id="addRepartidorModal" tabindex="-1"> <div class="modal-dialog"> <div class="modal-content"> <div class="modal-header"> <h1 class="modal-title fs-5">Agregar Repartidor</h1> <button type="button" class="btn-close" data-bs-dismiss="modal"></button> </div> <div class="modal-body"> <form id="form-add-repartidor"> <div class="mb-3"> <label for="new-repartidor-nombre" class="form-label">Nombre:</label> <input type="text" class="form-control" id="new-repartidor-nombre" required> </div> <div class="mb-3"> <label for="new-repartidor-celular" class="form-label">Celular:</label> <input type="tel" class="form-control" id="new-repartidor-celular" required> </div> </form> </div> <div class="modal-footer"> <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button> <button type="submit" form="form-add-repartidor" class="btn btn-primary">Guardar</button> </div> </div> </div> </div>
    <div class="modal fade" id="addIncomeModal" tabindex="-1"> <div class="modal-dialog"> <div class="modal-content"> <div class="modal-header"> <h1 class="modal-title fs-5">Ingreso Extra</h1> <button type="button" class="btn-close" data-bs-dismiss="modal"></button> </div> <div class="modal-body"> <form id="form-add-income"> <div class="mb-3"> <label for="income-amount" class="form-label">Monto ($):</label> <input type="number" step="0.01" class="form-control" id="income-amount" required> </div> <div class="mb-3"> <label for="income-description" class="form-label">Descripci√≥n:</label> <input type="text" class="form-control" id="income-description" required> </div> </form> </div> <div class="modal-footer"> <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button> <button type="submit" form="form-add-income" class="btn btn-primary">Guardar</button> </div> </div> </div> </div>
    <div class="modal fade" id="addExpenseModal" tabindex="-1"> <div class="modal-dialog"> <div class="modal-content"> <div class="modal-header"> <h1 class="modal-title fs-5">Gasto</h1> <button type="button" class="btn-close" data-bs-dismiss="modal"></button> </div> <div class="modal-body"> <form id="form-add-expense"> <div class="mb-3"> <label for="expense-amount" class="form-label">Monto ($):</label> <input type="number" step="0.01" class="form-control" id="expense-amount" required> </div> <div class="mb-3"> <label for="expense-description" class="form-label">Descripci√≥n:</label> <input type="text" class="form-control" id="expense-description" required> </div> </form> </div> <div class="modal-footer"> <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button> <button type="submit" form="form-add-expense" class="btn btn-primary">Guardar</button> </div> </div> </div> </div>
    <div class="modal fade" id="addSupplierModal" tabindex="-1"> <div class="modal-dialog"> <div class="modal-content"> <div class="modal-header"> <h1 class="modal-title fs-5">Agregar Proveedor</h1> <button type="button" class="btn-close" data-bs-dismiss="modal"></button> </div> <div class="modal-body"> <form id="form-add-supplier"> <div class="mb-3"> <label for="new-supplier-nombre" class="form-label">Nombre:</label> <input type="text" class="form-control" id="new-supplier-nombre" required> </div> <div class="mb-3"> <label for="new-supplier-contacto" class="form-label">Contacto:</label> <input type="text" class="form-control" id="new-supplier-contacto"> </div> <div class="mb-3"> <label for="new-supplier-telefono" class="form-label">Tel√©fono:</label> <input type="tel" class="form-control" id="new-supplier-telefono"> </div> </form> </div> <div class="modal-footer"> <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button> <button type="submit" form="form-add-supplier" class="btn btn-primary">Guardar</button> </div> </div> </div> </div>
    <div class="modal fade" id="editCategoryModal" tabindex="-1"> <div class="modal-dialog"> <div class="modal-content"> <div class="modal-header"> <h1 class="modal-title fs-5">Editar Categor√≠a</h1> <button type="button" class="btn-close" data-bs-dismiss="modal"></button> </div> <div class="modal-body"> <form id="form-edit-category"> <input type="hidden" id="edit-category-id"> <div class="mb-3"> <label for="edit-category-nombre" class="form-label">Nuevo Nombre:</label> <input type="text" class="form-control" id="edit-category-nombre" required> </div> </form> </div> <div class="modal-footer"> <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button> <button type="submit" form="form-edit-category" class="btn btn-primary">Guardar Cambios</button> </div> </div> </div> </div>
    <div class="modal fade" id="editSupplierModal" tabindex="-1"> <div class="modal-dialog"> <div class="modal-content"> <div class="modal-header"> <h1 class="modal-title fs-5">Editar Proveedor</h1> <button type="button" class="btn-close" data-bs-dismiss="modal"></button> </div> <div class="modal-body"> <form id="form-edit-supplier"> <input type="hidden" id="edit-supplier-id"> <div class="mb-3"> <label for="edit-supplier-nombre" class="form-label">Nombre:</label> <input type="text" class="form-control" id="edit-supplier-nombre" required> </div> <div class="mb-3"> <label for="edit-supplier-contacto" class="form-label">Contacto:</label> <input type="text" class="form-control" id="edit-supplier-contacto"> </div> <div class="mb-3"> <label for="edit-supplier-telefono" class="form-label">Tel√©fono:</label> <input type="tel" class="form-control" id="edit-supplier-telefono"> </div> </form> </div> <div class="modal-footer"> <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button> <button type="submit" form="form-edit-supplier" class="btn btn-primary">Guardar</button> </div> </div> </div> </div>
    <div class="modal fade" id="editClientModal" tabindex="-1"> <div class="modal-dialog"> <div class="modal-content"> <div class="modal-header"> <h1 class="modal-title fs-5">Editar Cliente</h1> <button type="button" class="btn-close" data-bs-dismiss="modal"></button> </div> <div class="modal-body"> <form id="form-edit-client"> <input type="hidden" id="edit-client-id"> <div class="mb-3"> <label for="edit-client-cedula" class="form-label">C√©dula:</label> <input type="text" class="form-control" id="edit-client-cedula"> </div> <div class="mb-3"> <label for="edit-client-nombre" class="form-label">Nombre:</label> <input type="text" class="form-control" id="edit-client-nombre" required> </div> <div class="mb-3"> <label for="edit-client-celular" class="form-label">Celular:</label> <input type="tel" class="form-control" id="edit-client-celular" required> </div> <div class="mb-3"> <label for="edit-client-direccion" class="form-label">Direcci√≥n:</label> <input type="text" class="form-control" id="edit-client-direccion"> </div> </form> </div> <div class="modal-footer"> <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button> <button type="submit" form="form-edit-client" class="btn btn-primary">Guardar</button> </div> </div> </div> </div>
    <div class="modal fade" id="deleteConfirmModal" tabindex="-1"> <div class="modal-dialog modal-dialog-centered"> <div class="modal-content"> <div class="modal-header"> <h1 class="modal-title fs-5 text-danger"><i class="bi bi-exclamation-triangle-fill me-2"></i>Confirmar Eliminaci√≥n</h1> <button type="button" class="btn-close" data-bs-dismiss="modal"></button> </div> <div class="modal-body"> <p>¬øEst√°s seguro?</p> <p><strong id="delete-item-name"></strong></p> <small class="text-muted">No se puede deshacer.</small> </div> <div class="modal-footer"> <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button> <button type="button" class="btn btn-danger" id="confirm-delete-btn" data-delete-id="" data-delete-collection="">Confirmar</button> </div> </div> </div> </div>
    <div class="modal fade"id="liquidateConfirmModal" tabindex="-1"> <div class="modal-dialog modal-dialog-centered"> <div class="modal-content"> <div class="modal-header"> <h1 class="modal-title fs-5">Confirmar Liquidaci√≥n</h1> <button type="button" class="btn-close" data-bs-dismiss="modal"></button> </div> <div class="modal-body"> <p>¬øConfirmas que recibiste <strong id="liquidate-amount" class="text-success"></strong> del repartidor <strong id="liquidate-name"></strong>?</p> <p id="liquidate-saldo-text" class="fw-bold"></p> </div> <div class="modal-footer"> <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button> <button type="button" class="btn btn-primary" id="confirm-liquidate-btn" data-liquidate-id="">Confirmar</button> </div> </div> </div> </div>
    <div class="modal fade" id="searchSupplierModal" tabindex="-1"> <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable"> <div class="modal-content"> <div class="modal-header"> <h1 class="modal-title fs-5">Buscar Proveedor</h1> <button type="button" class="btn-close" data-bs-dismiss="modal"></button> </div> <div class="modal-body"> <input type="search" class="form-control mb-3" id="supplier-modal-search" placeholder="Buscar por nombre..."> <ul class="list-group search-modal-list" id="supplier-modal-list"> </ul> </div> </div> </div> </div>
    <div class="modal fade" id="searchClientModal" tabindex="-1"> <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable"> <div class="modal-content"> <div class="modal-header"> <h1 class="modal-title fs-5">Buscar Cliente</h1> <button type="button" class="btn-close" data-bs-dismiss="modal"></button> </div> <div class="modal-body"> <input type="search" class="form-control mb-3" id="client-modal-search" placeholder="Buscar por nombre o c√©dula..."> <ul class="list-group search-modal-list" id="client-modal-list"> </ul> </div> </div> </div> </div>
    
    <div class="modal fade" id="searchProductModal" tabindex="-1"> <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable"> <div class="modal-content"> <div class="modal-header"> <h1 class="modal-title fs-5">Buscar Producto</h1> <button type="button" class="btn-close" data-bs-dismiss="modal"></button> </div> <div class="modal-body"> <input type="search" class="form-control mb-3" id="product-modal-search" placeholder="Buscar por nombre..."> <ul class="list-group search-modal-list" id="product-modal-list"> </ul> </div> </div> </div> </div>

    <div class="modal fade" id="selectVariationModal" tabindex="-1" aria-labelledby="selectVariationModalTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="selectVariationModalTitle">Seleccionar Variaci√≥n</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="variation-product-id">
                    <input type="hidden" id="variation-product-name">
                    <input type="hidden" id="variation-product-price">
                    
                    <div id="variation-options-container">
                        </div>
                    
                    <div id="variation-stock-display" class="alert alert-light text-center mt-3" style="display: none;">
                        Stock disponible: <span class="fw-bold">0</span>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="add-variation-to-cart-btn" disabled>A√±adir al Carrito</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="viewSaleModal" tabindex="-1" aria-labelledby="viewSaleModalTitle" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="viewSaleModalTitle">Detalle de Venta</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="viewSaleModalBody">
                    <div class="text-center">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Cargando...</span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <!-- Modal de Gesti√≥n de Promociones -->
    <div class="modal fade" id="promoModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-tag-fill me-2"></i>Gestionar Promoci√≥n
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="promo-product-id">
                    <input type="hidden" id="promo-product-price">

                    <div class="mb-3">
                        <h6 id="promo-product-name" class="text-primary"></h6>
                        <small class="text-muted">Precio normal: <strong id="promo-price-normal"></strong></small>
                    </div>

                    <div class="mb-3">
                        <div class="form-check form-switch d-flex align-items-center justify-content-between">
                            <label class="form-check-label mb-0" for="promo-active">
                                <strong>Promoci√≥n Activa</strong>
                            </label>
                            <input class="form-check-input ms-2" type="checkbox" id="promo-active">
                        </div>
                        <small class="text-muted d-block mt-1">Activa o desactiva la promoci√≥n en la tienda</small>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">Tipo de Promoci√≥n</label>
                        <div class="btn-group w-100" role="group">
                            <input type="radio" class="btn-check" name="promo-type" id="promo-type-percentage" value="percentage" checked>
                            <label class="btn btn-outline-primary" for="promo-type-percentage">
                                <i class="bi bi-percent"></i> Descuento %
                            </label>

                            <input type="radio" class="btn-check" name="promo-type" id="promo-type-fixed" value="fixed">
                            <label class="btn btn-outline-primary" for="promo-type-fixed">
                                <i class="bi bi-cash"></i> Precio Fijo
                            </label>
                        </div>
                    </div>

                    <div id="promo-percentage-section">
                        <div class="mb-3">
                            <label for="promo-discount-percentage" class="form-label">Descuento (%)</label>
                            <div class="input-group">
                                <input type="number" class="form-control" id="promo-discount-percentage"
                                       min="1" max="100" value="10" step="1">
                                <span class="input-group-text">%</span>
                            </div>
                            <div class="form-text">Precio final: <strong id="promo-final-price-percentage">$0</strong></div>
                        </div>
                    </div>

                    <div id="promo-fixed-section" style="display: none;">
                        <div class="mb-3">
                            <label for="promo-fixed-price" class="form-label">Precio Promocional</label>
                            <div class="input-group">
                                <span class="input-group-text">$</span>
                                <input type="number" class="form-control" id="promo-fixed-price"
                                       min="0" step="1000" placeholder="Ej: 25000">
                            </div>
                            <div class="form-text">Ahorro: <strong id="promo-savings-fixed">$0</strong></div>
                        </div>
                    </div>

                    <div class="alert alert-info mb-0">
                        <i class="bi bi-info-circle me-2"></i>
                        <strong>Importante:</strong> La promoci√≥n se aplicar√° autom√°ticamente en el cat√°logo web.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-danger" id="btn-remove-promo" style="display: none;">
                        <i class="bi bi-trash"></i> Quitar Promoci√≥n
                    </button>
                    <button type="button" class="btn btn-primary" id="btn-save-promo">
                        <i class="bi bi-check-lg"></i> Guardar Promoci√≥n
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Bajo Stock -->
    <div class="modal fade" id="bajoStockModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-exclamation-triangle text-warning me-2"></i>Productos con Bajo Stock
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="text-muted mb-3">Productos con 2 unidades o menos en inventario</p>
                    <div class="table-responsive">
                        <table class="table table-hover align-middle">
                            <thead class="table-light">
                                <tr>
                                    <th>Producto</th>
                                    <th>Variaci√≥n</th>
                                    <th class="text-center">Stock</th>
                                    <th>Categor√≠a</th>
                                </tr>
                            </thead>
                            <tbody id="bajo-stock-list">
                                <tr>
                                    <td colspan="4" class="text-center text-muted">Cargando...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Chart.js para gr√°ficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script type="module" src="admin.js?v=1.6.0"></script>

    <!-- Script para cerrar navegaci√≥n m√≥vil al hacer clic en un enlace -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Cerrar el men√∫ m√≥vil al hacer clic en cualquier enlace de navegaci√≥n
            const navLinks = document.querySelectorAll('.nav-pills .nav-link');
            const navbarCollapse = document.getElementById('adminNavbarContent');

            navLinks.forEach(link => {
                link.addEventListener('click', function() {
                    // Solo cerrar en m√≥vil (cuando el navbar est√° colapsado)
                    if (window.innerWidth < 992 && navbarCollapse.classList.contains('show')) {
                        // Usar Bootstrap para cerrar el collapse
                        const bsCollapse = bootstrap.Collapse.getInstance(navbarCollapse);
                        if (bsCollapse) {
                            bsCollapse.hide();
                        }
                    }
                });
            });
        });
    </script>

</body>
</html>
