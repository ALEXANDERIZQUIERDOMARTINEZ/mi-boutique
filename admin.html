<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Mishell Boutique</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="admin-styles.css?v=2.4.2">

    <!-- Logo/Icon -->
    <link rel="icon" href="icon.svg" type="image/svg+xml">
    <meta name="theme-color" content="#D988B9">

    <!-- SheetJS para leer archivos Excel -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>

    </head>
<body class="admin-page">

    <!-- üîò MOBILE TOGGLE BUTTON -->
    <button class="sidebar-toggle" id="sidebarToggle" type="button">
        <i class="bi bi-list"></i>
    </button>

    <!-- üéØ SIDEBAR VERTICAL FIJO - Full Height -->
    <aside class="admin-sidebar" id="adminSidebar">
        <!-- Brand / Logo -->
        <div class="sidebar-brand">
            <span>Mishell</span>
        </div>

        <!-- Navegaci√≥n Vertical -->
        <nav class="sidebar-nav">
            <ul class="nav flex-column">
                <!-- 1Ô∏è‚É£ DASHBOARD -->
                <li class="nav-item">
                    <a href="#dashboard" class="nav-link active" data-bs-toggle="pill" data-tooltip="Dashboard">
                        <i class="bi bi-grid-1x2"></i>
                        <span>Dashboard</span>
                    </a>
                </li>

                <!-- 2Ô∏è‚É£ VENTAS -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="javascript:void(0)" data-tooltip="Ventas">
                        <i class="bi bi-cart3"></i>
                        <span>Ventas</span>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#ventas" data-bs-toggle="pill"><i class="bi bi-plus-circle"></i>Registrar Venta</a></li>
                        <li><a class="dropdown-item position-relative" href="#pedidos-web" data-bs-toggle="pill">
                            <i class="bi bi-bag-check"></i>Pedidos Web
                            <span class="badge bg-danger ms-auto badge-new-order" id="pedidos-web-count" style="display: none;">0</span>
                        </a></li>
                        <li><a class="dropdown-item" href="#apartados" data-bs-toggle="pill"><i class="bi bi-bookmark-star"></i>Apartados</a></li>
                    </ul>
                </li>

                <!-- 3Ô∏è‚É£ INVENTARIO -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="javascript:void(0)" data-tooltip="Inventario">
                        <i class="bi bi-box-seam"></i>
                        <span>Inventario</span>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#productos" data-bs-toggle="pill"><i class="bi bi-grid"></i>Productos</a></li>
                        <li><a class="dropdown-item" href="#cargue-masivo" data-bs-toggle="pill"><i class="bi bi-file-earmark-excel"></i>Cargue Masivo</a></li>
                        <li><a class="dropdown-item" href="#categorias" data-bs-toggle="pill"><i class="bi bi-tags"></i>Categor√≠as</a></li>
                    </ul>
                </li>

                <!-- 4Ô∏è‚É£ CLIENTES -->
                <li class="nav-item">
                    <a href="#clientes" class="nav-link" data-bs-toggle="pill" data-tooltip="Clientes">
                        <i class="bi bi-people"></i>
                        <span>Clientes</span>
                    </a>
                </li>

                <!-- 5Ô∏è‚É£ LOG√çSTICA -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="javascript:void(0)" data-tooltip="Log√≠stica">
                        <i class="bi bi-truck"></i>
                        <span>Log√≠stica</span>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#repartidores" data-bs-toggle="pill"><i class="bi bi-bicycle"></i>Repartidores</a></li>
                        <li><a class="dropdown-item" href="#promociones" data-bs-toggle="pill"><i class="bi bi-megaphone"></i>Promociones</a></li>
                    </ul>
                </li>

                <!-- 6Ô∏è‚É£ FINANZAS -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="javascript:void(0)" data-tooltip="Finanzas">
                        <i class="bi bi-wallet2"></i>
                        <span>Finanzas</span>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#finanzas" data-bs-toggle="pill"><i class="bi bi-cash-coin"></i>Gesti√≥n Financiera</a></li>
                        <li><a class="dropdown-item" href="#reportes" data-bs-toggle="pill"><i class="bi bi-graph-up-arrow"></i>Reportes</a></li>
                        <li><a class="dropdown-item" href="#proveedores" data-bs-toggle="pill"><i class="bi bi-building"></i>Proveedores</a></li>
                    </ul>
                </li>

                <!-- 7Ô∏è‚É£ CONFIG -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="javascript:void(0)" data-tooltip="Configuraci√≥n">
                        <i class="bi bi-gear"></i>
                        <span>Config</span>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#usuarios" data-bs-toggle="pill"><i class="bi bi-person-lock"></i>Usuarios</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#backup" data-bs-toggle="pill"><i class="bi bi-cloud-arrow-down"></i>Backup</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="index.html" target="_blank"><i class="bi bi-shop"></i>Ver Cat√°logo</a></li>
                    </ul>
                </li>
            </ul>
        </nav>
    </aside>

    <!-- üìÑ MAIN CONTENT WRAPPER -->
    <div class="admin-content-wrapper">

    <div class="toast-container position-fixed top-0 start-0 p-3">
      <div id="liveToast" class="toast align-items-center border-0" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="d-flex">
            <div class="toast-body" id="toast-body"> Mensaje. </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
      </div>
    </div>

    <main class="admin-main">
        <!-- üë§ HEADER GLOBAL CON USUARIO Y FECHA (Siempre visible) -->
        <div style="
            position: sticky;
            top: 0;
            background: white;
            z-index: 100;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            margin-bottom: 1.5rem;
            display: flex;
            justify-content: flex-end;
            align-items: center;
            gap: 1rem;
        ">
            <!-- Fecha -->
            <div class="text-muted" style="font-size: 0.813rem; font-weight: 500;">
                <i class="bi bi-calendar-event-fill me-1"></i>Hoy: <span id="dashboard-date"></span>
            </div>

            <!-- User Profile Dropdown -->
            <div class="position-relative">
                            <button id="userProfileBtn" style="
                                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                                border: none;
                                border-radius: 50%;
                                width: 44px;
                                height: 44px;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                cursor: pointer;
                                box-shadow: 0 4px 12px rgba(102, 126, 234, 0.35);
                                transition: all 0.3s ease;
                                position: relative;
                            " onmouseover="this.style.transform='scale(1.1)'; this.style.boxShadow='0 6px 16px rgba(102, 126, 234, 0.45)';" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 4px 12px rgba(102, 126, 234, 0.35)';">
                                <i class="bi bi-person-fill" style="font-size: 1.25rem; color: white;"></i>
                                <!-- Indicador de badge online -->
                                <span style="
                                    position: absolute;
                                    bottom: 2px;
                                    right: 2px;
                                    width: 12px;
                                    height: 12px;
                                    background: #10b981;
                                    border: 2px solid white;
                                    border-radius: 50%;
                                    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
                                "></span>
                            </button>

                            <!-- Dropdown Menu -->
                            <div id="userDropdown" style="
                                display: none;
                                position: absolute;
                                top: calc(100% + 10px);
                                right: 0;
                                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                                border-radius: 0.875rem;
                                padding: 1rem;
                                box-shadow: 0 12px 24px rgba(102, 126, 234, 0.4);
                                min-width: 240px;
                                z-index: 1000;
                                animation: slideDown 0.3s ease;
                            ">
                                <!-- Flecha arriba -->
                                <div style="
                                    position: absolute;
                                    top: -6px;
                                    right: 18px;
                                    width: 12px;
                                    height: 12px;
                                    background: #667eea;
                                    transform: rotate(45deg);
                                "></div>

                                <!-- Contenido del dropdown -->
                                <div style="position: relative;">
                                    <!-- Avatar y nombre -->
                                    <div class="d-flex align-items-center gap-2 mb-3 pb-3" style="border-bottom: 1px solid rgba(255,255,255,0.2);">
                                        <div style="
                                            width: 42px;
                                            height: 42px;
                                            background: rgba(255,255,255,0.2);
                                            backdrop-filter: blur(10px);
                                            border-radius: 50%;
                                            display: flex;
                                            align-items: center;
                                            justify-content: center;
                                            flex-shrink: 0;
                                        ">
                                            <i class="bi bi-person-fill" style="font-size: 1.25rem; color: white;"></i>
                                        </div>
                                        <div class="flex-grow-1">
                                            <div id="currentUserInfo" style="color: white; font-weight: 600; font-size: 0.875rem; line-height: 1.3; margin-bottom: 0.15rem;"></div>
                                            <div id="currentUserRole" style="
                                                color: rgba(255,255,255,0.85);
                                                font-size: 0.688rem;
                                                font-weight: 500;
                                            "></div>
                                        </div>
                                    </div>

                                    <!-- Bot√≥n de logout -->
                                    <button id="logoutBtnHeader" style="
                                        width: 100%;
                                        background: rgba(255,255,255,0.2);
                                        backdrop-filter: blur(10px);
                                        border: 1px solid rgba(255,255,255,0.3);
                                        color: white;
                                        font-size: 0.813rem;
                                        font-weight: 600;
                                        padding: 0.625rem;
                                        border-radius: 0.5rem;
                                        transition: all 0.3s ease;
                                        cursor: pointer;
                                    " onmouseover="this.style.background='rgba(255,255,255,0.3)'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.2)';" onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                                        <i class="bi bi-box-arrow-right me-2"></i>Cerrar sesi√≥n
                                    </button>
                                </div>
                            </div>
                        </div>
        </div>
        <!-- FIN HEADER GLOBAL -->

        <div class="tab-content">
            <div class="tab-pane fade show active" id="dashboard">
                <div class="mb-4">
                    <h1 class="h2 mb-0">
                        <i class="bi bi-speedometer2 me-2"></i>Dashboard
                    </h1>
                </div>

                <!-- Tarjetas de Resumen Principal -->
                <div class="row g-4 mb-4">
                    <div class="col-md-3 col-sm-6">
                        <div class="dashboard-card card-ventas">
                            <div class="card-icon">
                                <i class="bi bi-wallet2"></i>
                            </div>
                            <div class="card-content">
                                <h6 class="card-label">Ventas Hoy</h6>
                                <p class="card-value" id="db-ventas-hoy">$0</p>
                                <small class="card-subtitle" id="db-ventas-count">0 ventas</small>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-3 col-sm-6">
                        <div class="dashboard-card card-productos">
                            <div class="card-icon">
                                <i class="bi bi-box-seam-fill"></i>
                            </div>
                            <div class="card-content">
                                <h6 class="card-label">Productos Totales</h6>
                                <p class="card-value" id="db-total-productos">0</p>
                                <small class="card-subtitle" id="db-productos-disponibles">0 disponibles</small>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-3 col-sm-6">
                        <div class="dashboard-card card-stock" style="cursor: pointer;" data-bs-toggle="modal" data-bs-target="#bajoStockModal">
                            <div class="card-icon">
                                <i class="bi bi-exclamation-triangle-fill"></i>
                            </div>
                            <div class="card-content">
                                <h6 class="card-label">Bajo Stock</h6>
                                <p class="card-value" id="db-bajo-stock">0</p>
                                <small class="card-subtitle">2 unidades o menos</small>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-3 col-sm-6">
                        <div class="dashboard-card card-apartados">
                            <div class="card-icon">
                                <i class="bi bi-clock-history"></i>
                            </div>
                            <div class="card-content">
                                <h6 class="card-label">Apartados Activos</h6>
                                <p class="card-value" id="db-apartados-vencer">0</p>
                                <small class="card-subtitle" id="db-apartados-total-saldo">$0 pendiente</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Accesos R√°pidos y Estad√≠sticas -->
                <div class="mb-3">
                    <h5 class="text-muted fw-light"><i class="bi bi-lightning-charge me-2"></i>Accesos R√°pidos</h5>
                </div>
                <div class="row g-3 mb-4">
                    <!-- Pedidos Web -->
                    <div class="col-sm-6 col-lg-3">
                        <div class="card shadow-sm border-0 h-100 hover-card" style="cursor: pointer;" onclick="document.querySelector('a[href=\'#pedidos-web\']').click()">
                            <div class="card-body text-center py-4">
                                <div class="d-flex align-items-center justify-content-center mb-3">
                                    <div class="icon-badge bg-info me-2" style="width: 55px; height: 55px; line-height: 55px; font-size: 24px;">
                                        <i class="bi bi-bag-check"></i>
                                    </div>
                                </div>
                                <h6 class="mb-2 text-muted">Pedidos Web</h6>
                                <h2 class="mb-2 fw-bold text-info" id="db-pedidos-web">0</h2>
                                <small class="text-muted d-block mb-2">Pedidos pendientes</small>
                                <button class="btn btn-sm btn-outline-info w-100" onclick="event.stopPropagation(); document.querySelector('a[href=\'#pedidos-web\']').click();">
                                    <i class="bi bi-arrow-right-circle me-1"></i>Ver pedidos
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Clientes -->
                    <div class="col-sm-6 col-lg-3">
                        <div class="card shadow-sm border-0 h-100 hover-card" style="cursor: pointer;" onclick="document.querySelector('a[href=\'#clientes\']').click()">
                            <div class="card-body text-center py-4">
                                <div class="d-flex align-items-center justify-content-center mb-3">
                                    <div class="icon-badge bg-success me-2" style="width: 55px; height: 55px; line-height: 55px; font-size: 24px;">
                                        <i class="bi bi-people"></i>
                                    </div>
                                </div>
                                <h6 class="mb-2 text-muted">Clientes</h6>
                                <h2 class="mb-2 fw-bold text-success" id="db-total-clientes">0</h2>
                                <small class="text-muted d-block mb-2">Registrados en total</small>
                                <button class="btn btn-sm btn-outline-success w-100" onclick="event.stopPropagation(); document.querySelector('a[href=\'#clientes\']').click();">
                                    <i class="bi bi-person-plus me-1"></i>Gestionar clientes
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Promociones -->
                    <div class="col-sm-6 col-lg-3">
                        <div class="card shadow-sm border-0 h-100 hover-card" style="cursor: pointer;" onclick="document.querySelector('a[href=\'#promociones\']').click()">
                            <div class="card-body text-center py-4">
                                <div class="d-flex align-items-center justify-content-center mb-3">
                                    <div class="icon-badge bg-warning me-2" style="width: 55px; height: 55px; line-height: 55px; font-size: 24px;">
                                        <i class="bi bi-tags"></i>
                                    </div>
                                </div>
                                <h6 class="mb-2 text-muted">Promociones</h6>
                                <h2 class="mb-2 fw-bold text-warning" id="db-promociones-activas">0</h2>
                                <small class="text-muted d-block mb-2">Activas actualmente</small>
                                <button class="btn btn-sm btn-outline-warning w-100" onclick="event.stopPropagation(); document.querySelector('a[href=\'#promociones\']').click();">
                                    <i class="bi bi-plus-circle me-1"></i>Crear promoci√≥n
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Repartidores -->
                    <div class="col-sm-6 col-lg-3">
                        <div class="card shadow-sm border-0 h-100 hover-card" style="cursor: pointer;" onclick="document.querySelector('a[href=\'#repartidores\']').click()">
                            <div class="card-body text-center py-4">
                                <div class="d-flex align-items-center justify-content-center mb-3">
                                    <div class="icon-badge bg-danger me-2" style="width: 55px; height: 55px; line-height: 55px; font-size: 24px;">
                                        <i class="bi bi-truck"></i>
                                    </div>
                                </div>
                                <h6 class="mb-2 text-muted">Repartidores</h6>
                                <h2 class="mb-2 fw-bold text-danger" id="db-total-repartidores">0</h2>
                                <small class="text-muted d-block mb-2">Disponibles</small>
                                <button class="btn btn-sm btn-outline-danger w-100" onclick="event.stopPropagation(); document.querySelector('a[href=\'#repartidores\']').click();">
                                    <i class="bi bi-gear me-1"></i>Gestionar equipo
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Secci√≥n: Herramientas del Cat√°logo -->
                <div class="card mb-4 border-0 shadow-sm">
                    <div class="card-body p-4">
                        <div class="row align-items-center">
                            <div class="col-lg-8">
                                <div class="d-flex align-items-center mb-3 mb-lg-0">
                                    <div class="icon-badge bg-primary me-3" style="width: 50px; height: 50px;">
                                        <i class="bi bi-file-pdf" style="font-size: 1.5rem;"></i>
                                    </div>
                                    <div>
                                        <h5 class="mb-1 fw-bold">Cat√°logo en PDF</h5>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4 text-lg-end">
                                <button class="btn btn-primary btn-lg" id="btn-descargar-catalogo-pdf">
                                    <i class="bi bi-download me-2"></i>
                                    Descargar cat√°logo en PDF
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Secci√≥n: Inversi√≥n e Inventario -->
                <div class="mb-3">
                    <h5 class="text-muted fw-light"><i class="bi bi-box-seam me-2"></i>Inversi√≥n e Inventario</h5>
                </div>
                <div class="row g-4 mb-4">
                    <div class="col-md-6">
                        <div class="dashboard-card card-inversion" style="cursor: pointer;" data-bs-toggle="modal" data-bs-target="#inversionInventarioModal">
                            <div class="card-icon">
                                <i class="bi bi-cash-stack"></i>
                            </div>
                            <div class="card-content">
                                <h6 class="card-label">Inversi√≥n Total en Inventario</h6>
                                <p class="card-value" id="db-inversion-inventario">$0</p>
                                <small class="card-subtitle" id="db-inventario-unidades">0 unidades</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="dashboard-card card-utilidad" style="cursor: pointer;" data-bs-toggle="modal" data-bs-target="#utilidadPotencialModal">
                            <div class="card-icon">
                                <i class="bi bi-graph-up-arrow"></i>
                            </div>
                            <div class="card-content">
                                <h6 class="card-label">Utilidad Potencial (Detal)</h6>
                                <p class="card-value" id="db-utilidad-potencial">$0</p>
                                <small class="card-subtitle" id="db-margen-utilidad"><i class="bi bi-percent"></i> 0% de margen</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Secci√≥n: An√°lisis de Datos -->
                <div class="mb-3">
                    <h5 class="text-muted fw-light"><i class="bi bi-bar-chart-line me-2"></i>An√°lisis de Datos</h5>
                </div>
                <div class="row g-4 mb-4">
                    <div class="col-lg-8">
                        <div class="card shadow-sm">
                            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                                <h5 class="mb-0"><i class="bi bi-graph-up me-2"></i>Tendencia de Ventas</h5>
                                <div class="btn-group btn-group-sm" role="group">
                                    <input type="radio" class="btn-check" name="chart-period" id="chart-7days" autocomplete="off" checked>
                                    <label class="btn btn-outline-primary" for="chart-7days">7 d√≠as</label>

                                    <input type="radio" class="btn-check" name="chart-period" id="chart-30days" autocomplete="off">
                                    <label class="btn btn-outline-primary" for="chart-30days">30 d√≠as</label>

                                    <input type="radio" class="btn-check" name="chart-period" id="chart-6months" autocomplete="off">
                                    <label class="btn btn-outline-primary" for="chart-6months">6 meses</label>
                                </div>
                            </div>
                            <div class="card-body">
                                <canvas id="ventasChart" height="80"></canvas>
                            </div>
                        </div>

                        <!-- ‚ö° NUEVA TABLA INTELIGENTE DE TENDENCIAS ‚ö° -->
                        <div class="card shadow-sm mt-4">
                            <div class="card-header bg-gradient-primary text-white d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">
                                    <i class="bi bi-lightning-charge-fill me-2"></i>An√°lisis Inteligente de Tendencias
                                </h5>
                                <div class="btn-group btn-group-sm" role="group">
                                    <input type="radio" class="btn-check" name="trends-period" id="trends-7days" autocomplete="off" checked>
                                    <label class="btn btn-outline-light btn-sm" for="trends-7days">7 d√≠as</label>

                                    <input type="radio" class="btn-check" name="trends-period" id="trends-14days" autocomplete="off">
                                    <label class="btn btn-outline-light btn-sm" for="trends-14days">14 d√≠as</label>

                                    <input type="radio" class="btn-check" name="trends-period" id="trends-30days" autocomplete="off">
                                    <label class="btn btn-outline-light btn-sm" for="trends-30days">30 d√≠as</label>
                                </div>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover table-trends mb-0" id="tablaTendencias">
                                        <thead class="table-light sticky-top">
                                            <tr>
                                                <th class="text-center" style="width: 60px;">
                                                    <i class="bi bi-hash"></i>
                                                </th>
                                                <th>
                                                    <i class="bi bi-calendar3 me-1"></i>Fecha
                                                </th>
                                                <th class="text-end">
                                                    <i class="bi bi-cash-stack me-1"></i>Ingresos
                                                </th>
                                                <th class="text-center">
                                                    <i class="bi bi-graph-up-arrow me-1"></i>vs. Per√≠odo Anterior
                                                </th>
                                                <th class="text-center">
                                                    <i class="bi bi-cart-check me-1"></i>Ventas
                                                </th>
                                                <th class="text-end">
                                                    <i class="bi bi-receipt me-1"></i>Ticket Prom.
                                                </th>
                                                <th class="text-center">
                                                    <i class="bi bi-speedometer2 me-1"></i>Rendimiento
                                                </th>
                                                <th class="text-center">
                                                    <i class="bi bi-trophy me-1"></i>Rating
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody id="tablaTendenciasBody">
                                            <!-- Datos cargados din√°micamente por JavaScript -->
                                            <tr>
                                                <td colspan="8" class="text-center py-5">
                                                    <div class="spinner-border text-primary" role="status">
                                                        <span class="visually-hidden">Cargando...</span>
                                                    </div>
                                                    <p class="text-muted mt-2 mb-0">Analizando tendencias de ventas...</p>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                                <!-- Resumen de Insights -->
                                <div class="border-top p-3 bg-light" id="trendsInsights">
                                    <div class="row g-3">
                                        <div class="col-md-3">
                                            <div class="d-flex align-items-center">
                                                <div class="bg-success bg-opacity-10 rounded-circle p-2 me-2">
                                                    <i class="bi bi-trophy-fill text-success"></i>
                                                </div>
                                                <div>
                                                    <small class="text-muted d-block">Mejor D√≠a</small>
                                                    <strong id="bestDay">--</strong>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="d-flex align-items-center">
                                                <div class="bg-primary bg-opacity-10 rounded-circle p-2 me-2">
                                                    <i class="bi bi-graph-up text-primary"></i>
                                                </div>
                                                <div>
                                                    <small class="text-muted d-block">Crecimiento Prom.</small>
                                                    <strong id="avgGrowth">--</strong>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="d-flex align-items-center">
                                                <div class="bg-info bg-opacity-10 rounded-circle p-2 me-2">
                                                    <i class="bi bi-receipt text-info"></i>
                                                </div>
                                                <div>
                                                    <small class="text-muted d-block">Ticket Prom. Global</small>
                                                    <strong id="globalAvgTicket">--</strong>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="d-flex align-items-center">
                                                <div class="bg-warning bg-opacity-10 rounded-circle p-2 me-2">
                                                    <i class="bi bi-exclamation-triangle-fill text-warning"></i>
                                                </div>
                                                <div>
                                                    <small class="text-muted d-block">Alertas</small>
                                                    <strong id="alertsCount">0</strong>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-4">
                        <div class="card h-100 shadow-sm">
                            <div class="card-header bg-white">
                                <h5 class="mb-0"><i class="bi bi-trophy me-2"></i>Top 15 Productos</h5>
                            </div>
                            <div class="card-body" style="max-height: 600px; overflow-y: auto;">
                                <canvas id="topProductosChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Nueva Fila: An√°lisis Avanzado de Ventas -->
                <div class="row g-4 mb-4">
                    <!-- Categor√≠as m√°s vendidas -->
                    <div class="col-lg-6">
                        <div class="card shadow-sm">
                            <div class="card-header bg-white">
                                <h5 class="mb-0"><i class="bi bi-tags-fill me-2"></i>Categor√≠as M√°s Vendidas</h5>
                            </div>
                            <div class="card-body">
                                <canvas id="categoriasChart" height="250"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- M√©todos de Pago -->
                    <div class="col-lg-6">
                        <div class="card shadow-sm">
                            <div class="card-header bg-white">
                                <h5 class="mb-0"><i class="bi bi-credit-card me-2"></i>M√©todos de Pago</h5>
                            </div>
                            <div class="card-body">
                                <canvas id="metodosPagoChart" height="250"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- An√°lisis Financiero -->
                <div class="row g-4 mb-4">
                    <!-- Ingresos vs Costos -->
                    <div class="col-lg-8">
                        <div class="card shadow-sm">
                            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                                <h5 class="mb-0"><i class="bi bi-graph-up-arrow me-2"></i>Ingresos vs Costos</h5>
                                <div class="btn-group btn-group-sm" role="group">
                                    <input type="radio" class="btn-check" name="financial-period" id="financial-7days" autocomplete="off" checked>
                                    <label class="btn btn-outline-success" for="financial-7days">7 d√≠as</label>

                                    <input type="radio" class="btn-check" name="financial-period" id="financial-30days" autocomplete="off">
                                    <label class="btn btn-outline-success" for="financial-30days">30 d√≠as</label>
                                </div>
                            </div>
                            <div class="card-body">
                                <canvas id="ingresosVsCostosChart" height="80"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Productos con Mejor Margen -->
                    <div class="col-lg-4">
                        <div class="card shadow-sm">
                            <div class="card-header bg-white">
                                <h5 class="mb-0"><i class="bi bi-star-fill me-2"></i>Mejor Margen</h5>
                            </div>
                            <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                                <canvas id="mejorMargenChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- KPIs Adicionales -->
                <div class="row g-4 mb-4">
                    <div class="col-md-3">
                        <div class="card shadow-sm border-0 h-100 bg-gradient" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                            <div class="card-body text-white text-center">
                                <i class="bi bi-graph-up-arrow" style="font-size: 2.5rem; opacity: 0.8;"></i>
                                <h6 class="mt-3 mb-2">Ticket Promedio</h6>
                                <h3 class="mb-0 fw-bold" id="db-ticket-promedio">$0</h3>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card shadow-sm border-0 h-100 bg-gradient" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                            <div class="card-body text-white text-center">
                                <i class="bi bi-cart-check" style="font-size: 2.5rem; opacity: 0.8;"></i>
                                <h6 class="mt-3 mb-2">Productos Vendidos</h6>
                                <h3 class="mb-0 fw-bold" id="db-productos-vendidos">0</h3>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card shadow-sm border-0 h-100 bg-gradient" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                            <div class="card-body text-white text-center">
                                <i class="bi bi-cash-coin" style="font-size: 2.5rem; opacity: 0.8;"></i>
                                <h6 class="mt-3 mb-2">Margen Promedio</h6>
                                <h3 class="mb-0 fw-bold" id="db-margen-promedio">0%</h3>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card shadow-sm border-0 h-100 bg-gradient" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                            <div class="card-body text-white text-center">
                                <i class="bi bi-clock-history" style="font-size: 2.5rem; opacity: 0.8;"></i>
                                <h6 class="mt-3 mb-2">Ventas Este Mes</h6>
                                <h3 class="mb-0 fw-bold" id="db-ventas-mes">$0</h3>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <div class="tab-pane fade" id="pedidos-web">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h1 class="h2 mb-0"><i class="bi bi-globe me-2"></i>Pedidos desde la Web</h1>
                    <button type="button" class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#deleteAllWebOrdersModal">
                        <i class="bi bi-trash3 me-2"></i>Eliminar Todos los Pedidos
                    </button>
                </div>
                <div class="card">
                    <div class="card-header bg-white border-0 pt-3">
                        <h3 class="h5 mb-0">Pedidos Pendientes</h3>
                    </div>
                    <div class="card-body p-0">
                        <div id="web-orders-container" class="p-3">
                            <div class="text-center text-muted py-5" id="loading-web-orders">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Cargando...</span>
                                </div>
                                <p class="mt-2">Cargando pedidos...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="productos"> 
                <div class="d-flex justify-content-between align-items-center mb-3"> 
                    <h1 class="h2 mb-0">Productos</h1> 
                    <div class="btn-group"> 
                        <button type="button" id="toggle-inventory-view-btn" class="btn btn-sm btn-outline-secondary active"><i class="bi bi-list-ul me-1"></i><span class="d-none d-md-inline"> Inventario</span></button> 
                        <button type="button" id="toggle-form-view-btn" class="btn btn-sm btn-outline-secondary"><i class="bi bi-plus-circle me-1"></i><span class="d-none d-md-inline"> Agregar/Editar</span></button> 
                    </div> 
                </div>
                
                <div class="row align-items-center mb-2 variation-row d-none" id="variation-template">
                    <div class="col-md-4"> <input type="text" class="form-control form-control-sm" name="variation_talla[]" placeholder="Talla"> </div>
                    <div class="col-md-4"> <input type="text" class="form-control form-control-sm" name="variation_color[]" placeholder="Color"> </div>
                    <div class="col-md-3"> <input type="number" class="form-control form-control-sm" name="variation_stock[]" min="0" value="1" placeholder="Stock"> </div>
                    <div class="col-md-1 text-end"> <button type="button" class="btn btn-sm btn-outline-danger remove-variation-btn p-1"> <i class="bi bi-trash3"></i> </button> </div>
                </div>
                
                <div id="form-view" style="display: none;"> 
                    <div class="card"> 
                        <div class="card-header bg-white border-0 pt-3"><h3 class="h5 mb-0" id="product-form-title">Formulario Producto</h3></div> 
                        <div class="card-body"> 
                            <form id="form-producto"> 
                                <input type="hidden" id="producto-id"> 
                                <div class="row">
                                    <div class="col-md-6 mb-3"> <label for="nombre" class="form-label">Nombre:</label> <input type="text" class="form-control" id="nombre" required> </div>
                                    <div class="col-md-3 mb-3"> <label for="codigo" class="form-label">C√≥digo:</label> <input type="text" class="form-control" id="codigo" placeholder="Autogenerado" readonly disabled> </div>
                                    <div class="col-md-3 mb-3">
                                        <label for="codigo-barras" class="form-label">C√≥digo de Barras:</label>
                                        <div class="input-group">
                                            <input type="text" class="form-control" id="codigo-barras" placeholder="Ej: 7501234567890" maxlength="13">
                                            <button class="btn btn-outline-primary" type="button" id="btn-generar-barcode" title="Generar c√≥digo autom√°tico"><i class="bi bi-upc-scan"></i></button>
                                        </div>
                                        <small class="form-text text-muted">EAN-13 o UPC</small>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12 mb-3">
                                        <label for="proveedor-producto" class="form-label">Proveedor:</label>
                                        <div class="input-group">
                                            <input type="text" class="form-control" id="proveedor-producto" placeholder="Seleccionar..." readonly data-bs-toggle="modal" data-bs-target="#searchSupplierModal" style="cursor: pointer;">
                                            <input type="hidden" id="proveedor-producto-id">
                                            <button class="btn btn-outline-secondary add-supplier-btn" type="button" data-bs-toggle="modal" data-bs-target="#addSupplierModal" title="Agregar">+</button>
                                        </div>
                                    </div>
                                </div> 
                                <div class="mb-3"> <label for="descripcion" class="form-label">Descripci√≥n:</label> <textarea class="form-control" id="descripcion" rows="2"></textarea> </div> 
                                <div class="mb-3"> <label for="categoria-producto" class="form-label">Categor√≠a:</label> <select class="form-select" id="categoria-producto"><option value="">Selecciona...</option></select> </div> 
                                <hr class="my-4"> 
                                <h5 class="mb-3">Precios</h5> 
                                <div class="row"> 
                                    <div class="col-md-4 mb-3"> <label for="costo-compra" class="form-label">Costo ($):</label> <input type="number" class="form-control" id="costo-compra" step="0.01" min="0" required> </div> 
                                    <div class="col-md-4 mb-3"> <label for="precio-detal" class="form-label">P. Detal ($):</label> <input type="number" class="form-control" id="precio-detal" step="0.01" min="0" required> <small id="margen-detal-info" class="form-text text-muted"></small> </div> 
                                    <div class="col-md-4 mb-3"> <label for="precio-mayor" class="form-label">P. Mayor ($):</label> <input type="number" class="form-control" id="precio-mayor" step="0.01" min="0"> <small id="margen-mayor-info" class="form-text text-muted"></small> </div> 
                                </div> 
                                <hr class="my-4"> 
                                <h5 class="mb-3">Variaciones</h5> 
                                <div id="variaciones-container"> </div> 
                                <button type="button" id="add-variation-btn" class="btn btn-sm btn-outline-primary mt-2"> <i class="bi bi-plus-lg"></i> A√±adir</button> 
                                <hr class="my-4"> 
                                <div class="row">
                                    <div class="col-md-8 mb-3">
                                        <label for="imagen" class="form-label">Fotos:</label>
                                        <input type="file" class="form-control" id="imagen" accept="image/*" multiple>
                                        <small class="text-muted" id="image-upload-label">La 1ra ser√° la principal. Si editas y no subes una nueva, se mantendr√° la anterior.</small>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label class="form-label d-block">Visibilidad en Tienda:</label>
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" role="switch" id="visibilidad" checked style="width: 3em; height: 1.5em;">
                                            <label class="form-check-label ms-2" for="visibilidad" style="font-size: 1.1rem; font-weight: 500;">Visible</label>
                                        </div>
                                        <small class="text-muted d-block mt-1">Activa para mostrar en cat√°logo p√∫blico</small>
                                    </div>
                                </div> 
                                <hr class="my-4"> 
                                <button type="submit" class="btn btn-primary" id="btn-save-product"> <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true" style="display: none;"></span> <span class="save-text">Guardar</span> </button> 
                                <button type="button" id="btn-clear-product-form" class="btn btn-outline-secondary ms-2">Limpiar</button> 
                            </form> 
                        </div> 
                    </div> 
                </div> 
                
                <!-- ‚úÖ INVENTARIO MEJORADO CON FILTROS -->
                <div id="inventory-view">
                    <!-- BOT√ìN DESCARGAR TODOS LOS C√ìDIGOS DE BARRAS -->
                    <div class="row mb-3">
                        <div class="col-12">
                            <button type="button" id="btn-download-all-barcodes" class="btn btn-success">
                                <i class="bi bi-file-earmark-excel me-1"></i>Descargar Todos los C√≥digos de Barras (Excel)
                            </button>
                        </div>
                    </div>

                    <!-- FILTROS MEJORADOS -->
                    <div class="row mb-3 g-2">
                        <div class="col-md-4">
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-search"></i></span>
                                <input type="search" id="search-inventory" class="form-control" placeholder="Buscar por nombre o c√≥digo...">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <select id="filter-category-inventory" class="form-select">
                                <option value="">Todas las Categor√≠as</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <select id="filter-supplier-inventory" class="form-select">
                                <option value="">Todos los Proveedores</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <div class="d-flex align-items-center justify-content-end mt-2" style="gap: 0.5rem;">
                                <label for="filter-low-stock-inventory" style="cursor: pointer; font-size: 0.9rem; margin: 0;">
                                    <i class="bi bi-exclamation-triangle text-warning"></i> Pocas unidades
                                </label>
                                <div class="form-check form-switch" style="margin: 0; padding: 0;">
                                    <input class="form-check-input" type="checkbox" id="filter-low-stock-inventory" style="cursor: pointer; margin: 0;">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-12">
                            <button type="button" id="clear-filters-inventory" class="btn btn-outline-secondary btn-sm">
                                <i class="bi bi-x-circle me-1"></i>Limpiar Filtros
                            </button>
                        </div>
                    </div>
                    
                    <!-- TABLA CON COLUMNA DE CATEGOR√çA -->
                    <div class="card">
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-hover align-middle mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Foto</th>
                                            <th>Nombre</th>
                                            <th>Categor√≠a</th>
                                            <th>Variaciones</th>
                                            <th>P. Detal</th>
                                            <th>P. Mayor</th>
                                            <th>Stock</th>
                                            <th>C√≥digo de Barras</th>
                                            <th>Promoci√≥n</th>
                                            <th>Estado</th>
                                            <th>Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody id="lista-inventario-productos">
                                        <tr id="empty-inventory-row">
                                            <td colspan="11" class="text-center text-muted p-4">Cargando...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div> 
                </div> 
            </div>
            
            <div class="tab-pane fade" id="ventas"> 
                <div class="d-flex justify-content-between align-items-center mb-3"> 
                    <h1 class="h2 mb-0">Ventas</h1> 
                    <div class="btn-group"> 
                        <button type="button" id="toggle-sales-form-view-btn" class="btn btn-sm btn-outline-secondary active"> <i class="bi bi-plus-circle me-1"></i><span class="d-none d-md-inline"> Registrar</span></button> 
                        <button type="button" id="toggle-sales-list-view-btn" class="btn btn-sm btn-outline-secondary"> <i class="bi bi-list-check me-1"></i><span class="d-none d-md-inline"> Historial</span></button> 
                    </div> 
                </div> 
                
                <div id="sales-form-view"> 
                    <div class="card"> 
                        <div class="card-header bg-white border-0 pt-3"><h3 class="h5 mb-0">Registrar Venta</h3></div> 
                        <div class="card-body"> 
                            <form id="form-venta"> 
                                <input type="hidden" id="venta-cliente-id"> 
                                <div class="row align-items-end">
                                    <div class="col-md-5 mb-3"> <label for="venta-cliente" class="form-label">Cliente:</label>
                                        <div class="input-group">
                                            <input type="text" id="venta-cliente" class="form-control" placeholder="Seleccionar..." readonly data-bs-toggle="modal" data-bs-target="#searchClientModal" style="cursor: pointer;">
                                            <button class="btn btn-outline-secondary add-client-btn" type="button" data-bs-toggle="modal" data-bs-target="#addClientModal" title="Agregar">+</button>
                                        </div>
                                        <div class="row mt-2 gx-2">
                                            <div class="col-6"> <input type="text" id="venta-cliente-celular" class="form-control form-control-sm client-info-display" placeholder="Celular" readonly disabled> </div>
                                            <div class="col-6"> <input type="text" id="venta-cliente-direccion" class="form-control form-control-sm client-info-display" placeholder="Direcci√≥n" readonly disabled> </div>
                                        </div>
                                    </div>
                                    <div class="col-md-2 mb-3"> <label for="tipo-venta-select" class="form-label">Tipo Venta:</label> <select id="tipo-venta-select" name="tipo-venta" class="form-select form-select-sm"> <option value="detal" selected>Detal</option> <option value="mayorista">Mayorista</option> <option value="apartado">Apartado</option> <option value="catalogo">Por Cat√°logo</option> </select> </div>
                                    <div class="col-md-3 mb-3"> <label for="tipo-entrega-select" class="form-label">Tipo Entrega:</label> <select id="tipo-entrega-select" name="tipo-entrega" class="form-select form-select-sm"> <option value="tienda" selected>Recoge Tienda</option> <option value="domicilio">Domicilio</option> </select> </div>
                                    <div class="col-md-2 mb-3 apartado-fecha-field" style="display: none;">
                                        <label for="apartado-fecha-max" class="form-label">Vence:</label>
                                        <input type="date" id="apartado-fecha-max" class="form-control form-control-sm">
                                    </div>
                                </div> 
                                <div class="row delivery-fields">
                                    <div class="col-md-6 mb-2"> <label for="venta-repartidor" class="form-label small mb-1">Repartidor:</label> <select id="venta-repartidor" class="form-select form-select-sm"></select> </div>
                                    <div class="col-md-6 mb-2"> <label for="costo-ruta" class="form-label small mb-1">Costo Ruta ($):</label> <input type="text" inputmode="numeric" id="costo-ruta" class="form-control form-control-sm" value="0"> </div>
                                </div>
                                <!-- üîç B√öSQUEDA R√ÅPIDA POR C√ìDIGO DE BARRAS -->
                                <div class="producto-tienda-field mb-2">
                                    <label for="barcode-scanner-input" class="form-label small mb-1"><i class="bi bi-upc-scan"></i> Escanear C√≥digo de Barras:</label>
                                    <input type="text" id="barcode-scanner-input" class="form-control form-control-sm" placeholder="Escanea o escribe c√≥digo..." autocomplete="off" autofocus>
                                    <small class="text-muted small">Escanea con lector USB o escribe el c√≥digo</small>
                                </div>
                                <div class="producto-tienda-field mb-2">
                                    <label for="venta-producto" class="form-label small mb-1">O Buscar Producto:</label>
                                    <input type="text" id="venta-producto" class="form-control form-control-sm" placeholder="Clic para buscar..." readonly data-bs-toggle="modal" data-bs-target="#searchProductModal" style="cursor: pointer;">
                                </div>

                                <div class="producto-catalogo-field" style="display: none;">
                                    <label class="form-label small mb-1">Agregar Item de Cat√°logo:</label>
                                    <div class="row g-2 mb-2">
                                        <div class="col-md-5">
                                            <input type="text" id="catalogo-descripcion" class="form-control form-control-sm" placeholder="Descripci√≥n del producto">
                                        </div>
                                        <div class="col-md-2">
                                            <input type="number" id="catalogo-cantidad" class="form-control form-control-sm" placeholder="Cant." min="1" value="1">
                                        </div>
                                        <div class="col-md-3">
                                            <input type="text" inputmode="numeric" id="catalogo-precio" class="form-control form-control-sm" placeholder="Precio unitario">
                                        </div>
                                        <div class="col-md-2">
                                            <button type="button" class="btn btn-primary btn-sm w-100" id="btn-agregar-item-catalogo">
                                                <i class="bi bi-plus-lg"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <table class="table table-sm table-hover align-middle my-2">
                                    <thead class="table-light"><tr><th>Producto</th><th>Cant.</th><th>Precio</th><th>Total</th><th></th></tr></thead>
                                    <tbody id="venta-carrito"></tbody>
                                </table>
                                <div class="row g-2">
                                    <div class="col-md-6">
                                        <div class="mb-2">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="venta-whatsapp" disabled>
                                                <label class="form-check-label small" for="venta-whatsapp">Pedido WhatsApp</label>
                                            </div>
                                        </div>
                                        <div class="mb-2 delivery-fields">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="ruta-pagada-transferencia">
                                                <label class="form-check-label small" for="ruta-pagada-transferencia">Ruta pagada por Transferencia</label>
                                            </div>
                                        </div>
                                        <label for="venta-observaciones" class="form-label small mb-1">Observaciones:</label>
                                        <textarea id="venta-observaciones" class="form-control form-control-sm" rows="2"></textarea>
                                        <div class="row mt-2">
                                            <div class="col-7">
                                                <label for="venta-descuento" class="form-label small mb-1">Descuento:</label>
                                                <input type="text" inputmode="numeric" id="venta-descuento" class="form-control form-control-sm" value="0">
                                            </div>
                                            <div class="col-5">
                                                <label class="form-label small mb-1">&nbsp;</label>
                                                <select class="form-select form-select-sm" id="venta-descuento-tipo"> <option value="fijo">$ Fijo</option> <option value="porcentaje">%</option> </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <!-- TOTAL PROMINENTE -->
                                        <div class="card bg-light border-0 mb-3">
                                            <div class="card-body p-2 text-center">
                                                <small class="text-muted d-block mb-1">Total a cobrar</small>
                                                <h3 class="mb-0"><span id="venta-total" class="text-primary fw-bold">$0</span></h3>
                                            </div>
                                        </div>

                                        <!-- M√âTODO DE PAGO -->
                                        <div class="btn-group w-100 mb-2" role="group">
                                            <input type="radio" class="btn-check" name="metodo-pago-radio" id="metodo-efectivo" value="efectivo" checked>
                                            <label class="btn btn-outline-success btn-sm" for="metodo-efectivo"><i class="bi bi-cash-coin"></i> Efectivo</label>
                                            <input type="radio" class="btn-check" name="metodo-pago-radio" id="metodo-transferencia" value="transferencia">
                                            <label class="btn btn-outline-primary btn-sm" for="metodo-transferencia"><i class="bi bi-bank"></i> Transfer.</label>
                                            <input type="radio" class="btn-check" name="metodo-pago-radio" id="metodo-mixto" value="mixto">
                                            <label class="btn btn-outline-warning btn-sm" for="metodo-mixto"><i class="bi bi-wallet2"></i> Mixto</label>
                                        </div>

                                        <!-- EFECTIVO -->
                                        <div id="efectivo-fields" class="payment-fields">
                                            <div class="input-group input-group-sm mb-2">
                                                <span class="input-group-text">üíµ Recibe</span>
                                                <input type="text" inputmode="numeric" id="efectivo-recibido" class="form-control" placeholder="0">
                                            </div>
                                            <div id="vuelto-efectivo-info" class="alert alert-success py-1 px-2 mb-0 small" style="display: none;">
                                                <strong>üí∏ Vuelto:</strong> <span id="vuelto-amount" class="fw-bold">$0</span>
                                            </div>
                                        </div>

                                        <!-- TRANSFERENCIA -->
                                        <div id="transferencia-fields" class="payment-fields" style="display: none;">
                                            <div class="input-group input-group-sm mb-2">
                                                <span class="input-group-text">üí≥ Monto</span>
                                                <input type="text" inputmode="numeric" id="transferencia-recibida" class="form-control" placeholder="0">
                                            </div>
                                            <div id="transferencia-info" class="alert alert-info py-1 px-2 mb-0 small" style="display: none;">
                                                <span class="text-danger fw-bold">‚ö†Ô∏è Falta: <span id="transferencia-falta">$0</span></span>
                                            </div>
                                        </div>

                                        <!-- MIXTO -->
                                        <div id="mixto-fields" class="payment-fields" style="display: none;">
                                            <div class="row g-1 mb-2">
                                                <div class="col-6">
                                                    <div class="input-group input-group-sm">
                                                        <span class="input-group-text">üíµ</span>
                                                        <input type="text" inputmode="numeric" id="efectivo-mixto-recibido" class="form-control" placeholder="0">
                                                    </div>
                                                </div>
                                                <div class="col-6">
                                                    <div class="input-group input-group-sm">
                                                        <span class="input-group-text">üí≥</span>
                                                        <input type="text" inputmode="numeric" id="transferencia-mixto-recibida" class="form-control" placeholder="0">
                                                    </div>
                                                </div>
                                            </div>
                                            <div id="mixto-info" class="alert alert-warning py-1 px-2 mb-0 small">
                                                <div class="d-flex justify-content-between">
                                                    <span>Recibido:</span>
                                                    <strong id="mixto-total-recibido">$0</strong>
                                                </div>
                                                <div id="vuelto-mixto-info" style="display: none;">
                                                    <strong>üí∏ Vuelto:</strong> <span id="vuelto-amount-mixto" class="fw-bold">$0</span>
                                                </div>
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-primary btn-sm w-100 mt-3">Registrar Venta</button>
                                    </div>
                                </div> 
                            </form> 
                        </div> 
                    </div> 
                </div> 
                
                <div id="sales-list-view">
                    <div class="card">
                        <div class="card-header bg-white border-0 pt-3">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h3 class="h5 mb-0">Historial</h3>
                            </div>
                            <div class="row g-2">
                                <div class="col-md-4">
                                    <label for="filtro-buscar-ventas" class="form-label small">Buscar cliente o producto:</label>
                                    <div class="input-group input-group-sm">
                                        <span class="input-group-text"><i class="bi bi-search"></i></span>
                                        <input type="text" id="filtro-buscar-ventas" class="form-control" placeholder="Nombre de cliente o producto...">
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <label for="filtro-categoria-ventas" class="form-label small">Categor√≠a:</label>
                                    <select id="filtro-categoria-ventas" class="form-select form-select-sm">
                                        <option value="">Todas las categor√≠as</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label for="filtro-fecha-ventas" class="form-label small">Fecha:</label>
                                    <input type="date" id="filtro-fecha-ventas" class="form-control form-control-sm">
                                </div>
                                <div class="col-md-2 d-flex align-items-end">
                                    <button type="button" id="btn-limpiar-filtro-ventas" class="btn btn-sm btn-outline-secondary w-100">
                                        <i class="bi bi-x-circle"></i> Limpiar
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-hover align-middle mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Fecha</th>
                                            <th>Cliente</th>
                                            <th>Productos</th>
                                            <th>Tipo</th>
                                            <th>Total</th>
                                            <th>Pago</th>
                                            <th>Repartidor</th>
                                            <th>Estado</th>
                                            <th>Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody id="lista-ventas-anteriores">
                                        <tr id="empty-sales-row">
                                            <td colspan="9" class="text-center text-muted p-4">Cargando...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div> 
            </div>
            
            <div class="tab-pane fade" id="apartados"> <h1 class="h2">Apartados</h1> <div class="card"><div class="card-header bg-white border-0 pt-3"><h3 class="h5 mb-0">Pendientes</h3></div><div class="card-body p-0"><div class="table-responsive"><table class="table table-hover align-middle mb-0"><thead class="table-light"><tr><th>Cliente</th><th>Productos</th><th>Total</th><th>Abonado</th><th>Saldo</th><th>Vence</th><th>Acciones</th></tr></thead><tbody id="lista-apartados"><tr><td colspan="7" class="text-center text-muted">Cargando...</td></tr></tbody></table></div></div></div> </div>
            <!--apartados-->
            <div class="modal fade" id="abonoApartadoModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Registrar Abono</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-light mb-3">
                    <h6 class="mb-2"><strong>Cliente:</strong> <span id="abono-cliente-nombre"></span></h6>
                    <div class="row text-center mt-3">
                        <div class="col-4">
                            <small class="text-muted d-block">Total</small>
                            <strong id="abono-total">$0</strong>
                        </div>
                        <div class="col-4">
                            <small class="text-muted d-block">Abonado</small>
                            <strong class="text-success" id="abono-abonado">$0</strong>
                        </div>
                        <div class="col-4">
                            <small class="text-muted d-block">Saldo</small>
                            <strong class="text-danger" id="abono-saldo">$0</strong>
                        </div>
                    </div>
                </div>
                
                <form id="form-abono-apartado">
                    <input type="hidden" id="abono-apartado-id">
                    <input type="hidden" id="abono-saldo-actual">
                    
                    <div class="mb-3">
                        <label for="abono-monto" class="form-label">Monto a Abonar ($)</label>
                        <input type="text"
                               inputmode="numeric"
                               class="form-control form-control-lg text-center"
                               id="abono-monto"
                               required
                               autofocus>
                        <small class="text-muted" id="abono-helper"></small>
                    </div>
                    
                    <div class="mb-3">
                        <label for="abono-metodo-pago" class="form-label">M√©todo de Pago</label>
                        <select class="form-select" id="abono-metodo-pago" required>
                            <option value="Efectivo">Efectivo</option>
                            <option value="Transferencia">Transferencia</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="abono-observaciones" class="form-label">Observaciones (Opcional)</label>
                        <textarea class="form-control" id="abono-observaciones" rows="2"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="submit" form="form-abono-apartado" class="btn btn-success">
                    <i class="bi bi-cash-coin me-1"></i> Registrar Abono
                </button>
            </div>
        </div>
    </div>
</div>

            <div class="modal fade" id="verApartadoModal" tabindex="-1">
                <div class="modal-dialog modal-dialog-centered modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Detalle del Apartado</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <p><strong>Cliente:</strong> <span id="detalle-cliente-nombre"></span></p>
                                    <p><strong>Estado:</strong> <span id="detalle-estado" class="badge"></span></p>
                                    <p><strong>Fecha de Vencimiento:</strong> <span id="detalle-vencimiento"></span></p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong>Total:</strong> <span id="detalle-total"></span></p>
                                    <p><strong>Abonado:</strong> <span id="detalle-abonado" class="text-success"></span></p>
                                    <p><strong>Saldo Pendiente:</strong> <span id="detalle-saldo" class="text-danger"></span></p>
                                </div>
                            </div>

                            <h6 class="border-top pt-3">Historial de Pagos</h6>
                            <div class="table-responsive">
                                <table class="table table-sm table-hover">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Fecha</th>
                                            <th>Monto</th>
                                            <th>M√©todo</th>
                                            <th>Observaciones</th>
                                        </tr>
                                    </thead>
                                    <tbody id="detalle-historial-pagos">
                                        <tr><td colspan="4" class="text-center text-muted">No hay pagos registrados</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                        </div>
                    </div>
                </div>
            </div>
            <!--apartados-->
            <div class="tab-pane fade" id="clientes"> <h1 class="h2">Clientes</h1> <div class="card"><div class="card-header bg-white border-0 pt-3 d-flex justify-content-between align-items-center"><h3 class="h5 mb-0">Lista</h3><button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#addClientModal"><i class="bi bi-plus-lg"></i> Nuevo</button></div><div class="card-body p-0"><div class="table-responsive"><table class="table table-hover align-middle mb-0"><thead class="table-light"><tr><th>Nombre</th><th>C√©dula</th><th>WhatsApp</th><th>Direcci√≥n</th><th>√öltima Compra</th><th>Acciones</th></tr></thead><tbody id="lista-clientes"><tr><td colspan="6" class="text-center text-muted">Cargando...</td></tr></tbody></table></div></div></div> </div>
            
            <div class="tab-pane fade" id="repartidores"> 
                <div class="d-flex justify-content-between align-items-center mb-3"> 
                    <h1 class="h2 mb-0">Repartidores</h1> 
                    <div class="btn-group"> 
                        <button type="button" id="toggle-delivery-today-btn" class="btn btn-sm btn-outline-secondary active"> <i class="bi bi-bicycle me-1"></i><span class="d-none d-md-inline"> Hoy</span></button> 
                        <button type="button" id="toggle-delivery-history-btn" class="btn btn-sm btn-outline-secondary"> <i class="bi bi-calendar-week me-1"></i><span class="d-none d-md-inline"> Historial</span></button> 
                    </div> 
                </div> 
                
                <div id="delivery-today-view"> 
                    <div class="card"><div class="card-header bg-white border-0 pt-3 d-flex justify-content-between align-items-center"><h3 class="h5 mb-0">Liquidaci√≥n Hoy</h3><button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#addRepartidorModal"><i class="bi bi-plus-lg"></i> Nuevo</button></div><div class="card-body p-0"><div class="table-responsive"><table class="table table-hover align-middle mb-0"><thead><tr><th>Repartidor</th><th># Ent.</th><th>Efec. Recibido</th><th>Rutas ($)</th><th>Rutas Transf. ($)</th><th>Efec. a Entregar ($)</th><th>Efec. Entregado ($)</th><th>Saldo ($)</th><th>Acciones</th></tr></thead><tbody id="lista-repartidores"><tr><td colspan="9" class="text-center text-muted">Cargando...</td></tr></tbody></table></div></div></div> 
                </div> 
                
                <div id="delivery-history-view"> 
                    <div class="card"><div class="card-header bg-white border-0 pt-3"><h3 class="h5 mb-0">Historial</h3></div><div class="card-body"><form id="form-filter-delivery-history" class="mb-3"><div class="row"><div class="col-md-4"><label for="history-repartidor" class="form-label">Repartidor:</label><select id="history-repartidor" class="form-select"></select></div><div class="col-md-3"><label for="history-desde" class="form-label">Desde:</label><input type="date" id="history-desde" class="form-control"></div><div class="col-md-3"><label for="history-hasta" class="form-label">Hasta:</label><input type="date" id="history-hasta" class="form-control"></div><div class="col-md-2 d-flex align-items-end"><button type="submit" class="btn btn-primary w-100">Filtrar</button></div></div></form><div class="table-responsive"><table class="table table-hover align-middle mb-0"><thead class="table-light"><tr><th>Fecha</th><th>Repartidor</th><th>Efec. Esperado</th><th>Efec. Entregado</th><th>Diferencia</th></tr></thead><tbody id="lista-historial-repartidores"><tr><td colspan="5" class="text-center text-muted">Filtra.</td></tr></tbody></table></div></div></div> 
                </div> 
            </div>
            
            <div class="tab-pane fade" id="reportes">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h1 class="h2 mb-0"><i class="bi bi-file-earmark-bar-graph me-2"></i>Reportes</h1>
                    <button type="button" id="btn-imprimir-reporte" class="btn btn-outline-secondary" style="display: none;">
                        <i class="bi bi-printer"></i> Imprimir
                    </button>
                </div>

                <div class="card">
                    <div class="card-header bg-white">
                        <h5 class="mb-0">Generar Reporte</h5>
                    </div>
                    <div class="card-body">
                        <form id="form-reporte">
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <label for="reporte-tipo" class="form-label">Tipo de Reporte:</label>
                                    <select id="reporte-tipo" class="form-select">
                                        <option value="">Seleccionar...</option>
                                        <option value="ventas">üìä Ventas</option>
                                        <option value="utilidad">üí∞ Utilidad</option>
                                        <option value="mas-vendidos">üèÜ M√°s Vendidos</option>
                                        <option value="repartidor">üö¥ Por Repartidor</option>
                                        <option value="apartados">üìÖ Apartados</option>
                                        <option value="descuentos">üéÅ Descuentos</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label for="reporte-desde" class="form-label">Desde:</label>
                                    <input type="date" id="reporte-desde" class="form-control" required>
                                </div>
                                <div class="col-md-3">
                                    <label for="reporte-hasta" class="form-label">Hasta:</label>
                                    <input type="date" id="reporte-hasta" class="form-control" required>
                                </div>
                                <div class="col-md-2 d-flex align-items-end">
                                    <button type="submit" class="btn btn-primary w-100">
                                        <i class="bi bi-clipboard-data-fill"></i> Generar
                                    </button>
                                </div>
                            </div>

                            <!-- Filtro adicional para repartidores -->
                            <div id="reporte-repartidor-filter" class="row g-3 mt-2" style="display: none;">
                                <div class="col-md-4">
                                    <label for="reporte-repartidor-select" class="form-label">Seleccionar Repartidor:</label>
                                    <select id="reporte-repartidor-select" class="form-select">
                                        <option value="">Todos los repartidores</option>
                                    </select>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- √Årea de resultados -->
                <div id="area-reporte" class="mt-4">
                    <div class="text-center text-muted py-5">
                        <i class="bi bi-file-earmark-text" style="font-size: 3rem;"></i>
                        <p class="mt-3">Selecciona un tipo de reporte y las fechas para generar</p>
                    </div>
                </div>
            </div>

            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                 SECCI√ìN: PROMOCIONES GLOBALES
                 ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <div class="tab-pane fade" id="promociones">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h1 class="h2 mb-0"><i class="bi bi-tag-fill me-2"></i>Promociones Globales</h1>
                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addPromocionGlobalModal">
                        <i class="bi bi-plus-circle me-1"></i> Nueva Promoci√≥n
                    </button>
                </div>

                <!-- Instrucciones -->
                <div class="alert alert-info mb-4">
                    <h6><i class="bi bi-info-circle me-2"></i>Acerca de las Promociones Globales</h6>
                    <p class="mb-0">Las promociones globales aplican un descuento a <strong>toda la tienda</strong> durante un per√≠odo espec√≠fico. Son ideales para eventos como Black Friday, Navidad, etc. Los productos con promociones individuales mantienen su descuento original.</p>
                </div>

                <!-- Lista de Promociones Globales -->
                <div class="card shadow-sm">
                    <div class="card-header bg-white">
                        <h5 class="mb-0"><i class="bi bi-list-check me-2"></i>Promociones Configuradas</h5>
                    </div>
                    <div class="card-body">
                        <div id="promociones-globales-container">
                            <div class="text-center py-5 text-muted">
                                <i class="bi bi-tag" style="font-size: 3rem; opacity: 0.3;"></i>
                                <p class="mt-3">No hay promociones globales configuradas</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="finanzas">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h1 class="h2 mb-0">Finanzas</h1>
                    <div class="btn-group">
                        <button type="button" class="btn btn-sm btn-outline-warning" id="btn-diagnostico-ventas"> <i class="bi bi-bug-fill"></i> DIAGNOSTICAR</button>
                        <button type="button" class="btn btn-sm btn-outline-success" data-bs-toggle="modal" data-bs-target="#addIncomeModal"> <i class="bi bi-plus-circle"></i><span class="d-none d-md-inline"> Ingreso</span></button>
                        <button type="button" class="btn btn-sm btn-outline-danger" data-bs-toggle="modal" data-bs-target="#addExpenseModal"> <i class="bi bi-dash-circle"></i><span class="d-none d-md-inline"> Gasto</span></button>
                        <button type="button" id="toggle-closing-today-btn" class="btn btn-sm btn-outline-secondary active"> <i class="bi bi-box-arrow-in-down me-1"></i><span class="d-none d-md-inline"> Cierre Hoy</span></button>
                        <button type="button" id="toggle-closing-history-btn" class="btn btn-sm btn-outline-secondary"> <i class="bi bi-calendar-week me-1"></i><span class="d-none d-md-inline"> Historial</span></button>
                    </div>
                </div>

                <!-- √Årea de diagn√≥stico -->
                <div id="diagnostico-area" class="alert alert-warning d-none mb-3" role="alert">
                    <h5>üîç Diagn√≥stico de Ventas</h5>
                    <pre id="diagnostico-resultado" style="max-height: 300px; overflow-y: auto; background: #fff; padding: 10px; border-radius: 5px;"></pre>
                </div>

                <!-- Vista de Movimientos Financieros -->
                <div id="finances-movements-view" class="mb-4">
                    <div class="row g-3 mb-3">
                        <div class="col-md-3">
                            <div class="card border-success">
                                <div class="card-body text-center">
                                    <i class="bi bi-cash-coin text-success" style="font-size: 2rem;"></i>
                                    <h6 class="mt-2 mb-1 text-muted">Efectivo</h6>
                                    <h3 class="mb-0 text-success" id="total-efectivo">$0</h3>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card border-info">
                                <div class="card-body text-center">
                                    <i class="bi bi-credit-card-fill text-info" style="font-size: 2rem;"></i>
                                    <h6 class="mt-2 mb-1 text-muted">Transferencias</h6>
                                    <h3 class="mb-0 text-info" id="total-transferencias">$0</h3>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card border-danger">
                                <div class="card-body text-center">
                                    <i class="bi bi-arrow-down-circle-fill text-danger" style="font-size: 2rem;"></i>
                                    <h6 class="mt-2 mb-1 text-muted">Gastos</h6>
                                    <h3 class="mb-0 text-danger" id="total-gastos">$0</h3>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card border-primary">
                                <div class="card-body text-center">
                                    <i class="bi bi-wallet-fill text-primary" style="font-size: 2rem;"></i>
                                    <h6 class="mt-2 mb-1 text-muted">Balance</h6>
                                    <h3 class="mb-0" id="balance-total">$0</h3>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header bg-white border-0 pt-3 d-flex justify-content-between align-items-center">
                            <h3 class="h5 mb-0">Movimientos Financieros</h3>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-primary active" id="filter-all-movements">Todos</button>
                                <button class="btn btn-outline-success" id="filter-income">Ingresos</button>
                                <button class="btn btn-outline-danger" id="filter-expenses">Gastos</button>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-hover align-middle mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Fecha</th>
                                            <th>Tipo</th>
                                            <th>Descripci√≥n</th>
                                            <th>Monto</th>
                                            <th>Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody id="lista-movimientos-financieros">
                                        <tr>
                                            <td colspan="5" class="text-center text-muted">Cargando...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="closing-today-view"> 
                    <div class="card"><div class="card-header bg-white border-0 pt-3"><h3 class="h5 mb-0">Cierre Diario</h3></div><div class="card-body"><form id="form-cierre-caja"><div class="row"><div class="col-md-3"><label class="form-label">Ventas Efectivo:</label><input type="text" class="form-control" id="caja-efectivo" value="$0" readonly></div><div class="col-md-3"><label class="form-label">Abonos Efectivo:</label><input type="text" class="form-control" id="caja-abonos-efectivo" value="$0" readonly></div><div class="col-md-3"><label class="form-label">Recibido Repart.:</label><input type="text" class="form-control" id="caja-recibido-repartidores" value="$0" readonly></div><div class="col-md-3"><label for="caja-egresos" class="form-label">Gastos ($):</label><input type="number" class="form-control" id="caja-egresos" value="0" step="0.01"></div></div><div class="row mt-3"><div class="col-md-9"><label for="caja-observaciones" class="form-label">Observaciones:</label><input type="text" class="form-control" id="caja-observaciones"></div><div class="col-md-3"><label class="form-label">Total Caja:</label><input type="text" class="form-control fw-bold" id="caja-total" value="$0" readonly></div></div><hr><p class="text-muted small">Nota: Transferencias no afectan efectivo.</p><button type="submit" class="btn btn-primary mt-3">Realizar Cierre</button></form></div></div> 
                </div> 
                
                <div id="closing-history-view" style="display: none;">
                    <!-- Resumen de Cierres Recientes -->
                    <div class="row g-3 mb-4">
                        <div class="col-md-4">
                            <div class="card border-primary">
                                <div class="card-body text-center">
                                    <i class="bi bi-calendar-day text-primary" style="font-size: 2rem;"></i>
                                    <h6 class="mt-2 mb-1 text-muted">Cierre de Hoy</h6>
                                    <h3 class="mb-0 text-primary" id="cierre-hoy-total">$0</h3>
                                    <small class="text-muted" id="cierre-hoy-fecha">-</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card border-secondary">
                                <div class="card-body text-center">
                                    <i class="bi bi-calendar-minus text-secondary" style="font-size: 2rem;"></i>
                                    <h6 class="mt-2 mb-1 text-muted">Cierre de Ayer</h6>
                                    <h3 class="mb-0 text-secondary" id="cierre-ayer-total">$0</h3>
                                    <small class="text-muted" id="cierre-ayer-fecha">-</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card border-success">
                                <div class="card-body text-center">
                                    <i class="bi bi-calendar-week text-success" style="font-size: 2rem;"></i>
                                    <h6 class="mt-2 mb-1 text-muted">Total Semana</h6>
                                    <h3 class="mb-0 text-success" id="cierre-semana-total">$0</h3>
                                    <small class="text-muted" id="cierre-semana-cantidad">0 cierres</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tabla de Historial -->
                    <div class="card">
                        <div class="card-header bg-white border-0 pt-3">
                            <h3 class="h5 mb-0">Todos los Cierres</h3>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-hover align-middle mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Fecha</th>
                                            <th>Ventas Efec.</th>
                                            <th>Abonos Efec.</th>
                                            <th>Recibido Repart.</th>
                                            <th>Gastos</th>
                                            <th>Total Caja</th>
                                            <th>Obs.</th>
                                        </tr>
                                    </thead>
                                    <tbody id="lista-historial-cierres">
                                        <tr>
                                            <td colspan="7" class="text-center text-muted">Cargando...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                 SECCI√ìN CARGUE MASIVO DE PRODUCTOS DESDE EXCEL
                 ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <div class="tab-pane fade" id="cargue-masivo">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h1 class="h2 mb-0">
                        <i class="bi bi-file-earmark-excel me-2"></i>Cargue Masivo de Productos
                    </h1>
                </div>

                <!-- PASO 1: SUBIR ARCHIVO -->
                <div id="paso-subir" class="cargue-paso active">
                    <div class="card shadow-sm">
                        <div class="card-body p-5 text-center">
                            <div class="mb-4">
                                <i class="bi bi-cloud-upload text-primary" style="font-size: 4rem;"></i>
                            </div>
                            <h3 class="mb-3">Paso 1: Subir Archivo Excel</h3>
                            <p class="text-muted mb-4">
                                Sube un archivo .xlsx o .csv con tus productos.
                                La primera fila debe contener los encabezados obligatorios.
                            </p>

                            <!-- Formato obligatorio -->
                            <div class="alert alert-info text-start mb-4">
                                <h6 class="alert-heading"><i class="bi bi-info-circle me-2"></i>Formato del Excel</h6>
                                <p class="mb-2"><strong>Columnas obligatorias (primera fila):</strong></p>
                                <code class="d-block bg-white p-2 rounded mb-2">
                                    nombre | categoria | proveedor | precio_detal | precio_mayor | talla | color | cantidad
                                </code>
                                <p class="mb-2 mt-2"><strong>Columnas opcionales:</strong></p>
                                <code class="d-block bg-white p-2 rounded mb-3">
                                    codigo | descripcion | costo
                                </code>
                                <div class="alert alert-success mb-2">
                                    <strong>‚ú® NUEVO: Campo C√ìDIGO (Recomendado)</strong>
                                    <small class="d-block mt-1">
                                        ‚Ä¢ Incluye el <strong>c√≥digo</strong> del producto existente para actualizar sus variaciones<br>
                                        ‚Ä¢ Si incluyes c√≥digo, NO se crear√°n duplicados<br>
                                        ‚Ä¢ Puedes encontrar el c√≥digo en la lista de productos<br>
                                        ‚Ä¢ Si no incluyes c√≥digo, el sistema lo generar√° autom√°ticamente
                                    </small>
                                </div>
                                <small class="text-muted d-block">
                                    ‚Ä¢ Si no incluyes <strong>costo</strong>, se calcular√° autom√°ticamente como el 50% del precio_detal<br>
                                    ‚Ä¢ Si no incluyes <strong>descripcion</strong>, quedar√° vac√≠a<br>
                                    ‚Ä¢ Cada fila representa una variaci√≥n del producto<br>
                                    ‚Ä¢ Los campos vac√≠os en talla/color se permiten para productos sin variaciones<br>
                                    ‚Ä¢ Los nombres de columnas no distinguen may√∫sculas/min√∫sculas
                                </small>
                            </div>

                            <input type="file"
                                   id="input-archivo-excel"
                                   accept=".xlsx,.xls,.csv"
                                   style="display: none;">

                            <button type="button" class="btn btn-primary btn-lg" id="btn-seleccionar-archivo">
                                <i class="bi bi-folder2-open me-2"></i>Seleccionar Archivo
                            </button>
                        </div>
                    </div>
                </div>

                <!-- PASO 2: VISTA PREVIA Y EDICI√ìN -->
                <div id="paso-vista-previa" class="cargue-paso" style="display: none;">
                    <div class="card shadow-sm">
                        <div class="card-header bg-white d-flex justify-content-between align-items-center py-3">
                            <h5 class="mb-0">
                                <i class="bi bi-table me-2"></i>Paso 2: Vista Previa y Validaci√≥n
                            </h5>
                            <div>
                                <button type="button" class="btn btn-outline-secondary me-2" id="btn-cancelar-cargue">
                                    <i class="bi bi-x-circle me-1"></i>Cancelar
                                </button>
                                <button type="button" class="btn btn-success" id="btn-procesar-datos" disabled>
                                    <i class="bi bi-check-circle me-1"></i>Procesar Datos
                                </button>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            <!-- Resumen de archivo -->
                            <div class="p-3 bg-light border-bottom">
                                <div class="row">
                                    <div class="col-md-3">
                                        <small class="text-muted d-block">Archivo:</small>
                                        <strong id="nombre-archivo">-</strong>
                                    </div>
                                    <div class="col-md-3">
                                        <small class="text-muted d-block">Total Filas:</small>
                                        <strong id="total-filas">0</strong>
                                    </div>
                                    <div class="col-md-3">
                                        <small class="text-muted d-block">Filas V√°lidas:</small>
                                        <strong class="text-success" id="filas-validas">0</strong>
                                    </div>
                                    <div class="col-md-3">
                                        <small class="text-muted d-block">Filas con Errores:</small>
                                        <strong class="text-danger" id="filas-errores">0</strong>
                                    </div>
                                </div>
                            </div>

                            <!-- Tabla editable -->
                            <div class="table-responsive" style="max-height: 600px; overflow-y: auto;">
                                <table class="table table-hover table-sm mb-0" id="tabla-vista-previa">
                                    <thead class="sticky-top bg-white" style="top: 0; z-index: 10;">
                                        <tr>
                                            <th width="40">#</th>
                                            <th>Nombre</th>
                                            <th>Descripci√≥n</th>
                                            <th>Categor√≠a</th>
                                            <th>Proveedor</th>
                                            <th width="100">Costo</th>
                                            <th width="100">P. Detal</th>
                                            <th width="100">P. Mayor</th>
                                            <th width="80">Talla</th>
                                            <th width="80">Color</th>
                                            <th width="80">Cantidad</th>
                                            <th width="60">Acci√≥n</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tbody-vista-previa">
                                        <!-- Las filas se cargan din√°micamente -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PASO 3: CONFIRMACI√ìN Y DUPLICADOS -->
                <div id="paso-confirmacion" class="cargue-paso" style="display: none;">
                    <div class="card shadow-sm">
                        <div class="card-header bg-white py-3">
                            <h5 class="mb-0">
                                <i class="bi bi-exclamation-triangle me-2"></i>Paso 3: Confirmaci√≥n y Duplicados
                            </h5>
                        </div>
                        <div class="card-body">
                            <!-- Resumen de productos agrupados -->
                            <div class="alert alert-info mb-4">
                                <h6 class="alert-heading">Resumen de Productos Procesados</h6>
                                <div class="row mt-3">
                                    <div class="col-md-4">
                                        <small class="text-muted d-block">Total Productos:</small>
                                        <strong id="resumen-total-productos">0</strong>
                                    </div>
                                    <div class="col-md-4">
                                        <small class="text-muted d-block">Total Variaciones:</small>
                                        <strong id="resumen-total-variaciones">0</strong>
                                    </div>
                                    <div class="col-md-4">
                                        <small class="text-muted d-block">Total Unidades:</small>
                                        <strong id="resumen-total-unidades">0</strong>
                                    </div>
                                </div>
                            </div>

                            <!-- Advertencias de nombres similares -->
                            <div id="seccion-advertencias" style="display: none;">
                                <div class="alert alert-danger">
                                    <h6 class="alert-heading">
                                        <i class="bi bi-exclamation-triangle-fill me-2"></i>‚ö†Ô∏è Advertencia: Posibles Duplicados
                                    </h6>
                                    <p class="mb-0">Los siguientes productos del Excel tienen el mismo nombre que productos existentes, pero diferente categor√≠a o proveedor:</p>
                                </div>
                                <div id="lista-advertencias" class="mb-4">
                                    <!-- Se llenan din√°micamente -->
                                </div>
                            </div>

                            <!-- Productos duplicados -->
                            <div id="seccion-duplicados" style="display: none;">
                                <div class="alert alert-warning">
                                    <h6 class="alert-heading">
                                        <i class="bi bi-exclamation-circle me-2"></i>Productos Duplicados Detectados
                                    </h6>
                                    <p class="mb-0">Los siguientes productos ya existen en el inventario. Selecciona una acci√≥n:</p>
                                </div>
                                <div id="lista-duplicados" class="mb-4">
                                    <!-- Se llenan din√°micamente -->
                                </div>
                            </div>

                            <!-- Botones de acci√≥n -->
                            <div class="d-flex justify-content-end gap-2">
                                <button type="button" class="btn btn-outline-secondary" id="btn-volver-edicion">
                                    <i class="bi bi-arrow-left me-1"></i>Volver a Editar
                                </button>
                                <button type="button" class="btn btn-success btn-lg" id="btn-confirmar-carga">
                                    <i class="bi bi-check-circle me-2"></i>Confirmar Carga al Inventario
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- LOADER ANIMADO -->
                <div id="cargue-loader" class="cargue-loader" style="display: none;">
                    <div class="loader-content">
                        <div class="spinner-border text-primary mb-3" role="status" style="width: 4rem; height: 4rem;">
                            <span class="visually-hidden">Cargando...</span>
                        </div>
                        <h4 id="loader-mensaje">Procesando...</h4>
                        <div class="progress mt-3" style="height: 30px; width: 300px;">
                            <div class="progress-bar progress-bar-striped progress-bar-animated"
                                 role="progressbar"
                                 id="loader-progreso"
                                 style="width: 0%;">
                                <span id="loader-porcentaje">0%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="categorias"> <h1 class="h2">Categor√≠as</h1> <div class="row"><div class="col-md-6"><div class="card"><div class="card-header bg-white border-0 pt-3"> <h3 class="h5 mb-0">Agregar</h3> </div><div class="card-body"><form id="form-categoria"><div class="mb-3"> <label for="nombre-categoria" class="form-label">Nombre:</label> <input type="text" id="nombre-categoria" class="form-control" required> </div><button type="submit" class="btn btn-primary">Guardar</button></form></div></div></div><div class="col-md-6"><div class="card"><div class="card-header bg-white border-0 pt-3"> <h3 class="h5 mb-0">Existentes</h3> </div><div class="card-body p-0"><ul class="list-group list-group-flush" id="lista-categorias"><li class="list-group-item text-muted" id="loading-categories">Cargando...</li></ul></div></div></div></div> </div>
            
            <div class="tab-pane fade" id="proveedores"> <h1 class="h2">Proveedores</h1> <div class="card"><div class="card-header bg-white border-0 pt-3 d-flex justify-content-between align-items-center"><h3 class="h5 mb-0">Lista</h3><button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#addSupplierModal"><i class="bi bi-plus-lg"></i> Nuevo</button></div><div class="card-body p-0"><div class="table-responsive"><table class="table table-hover align-middle mb-0"><thead><tr><th>Nombre</th><th>Contacto</th><th>Tel√©fono</th><th>Acciones</th></tr></thead><tbody id="lista-proveedores-tabla"><tr><td colspan="4" class="text-center text-muted">Cargando...</td></tr></tbody></table></div></div></div> </div>

            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                 SECCI√ìN CHATBOT
                 ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                 SECCI√ìN BACKUP/EXPORTACI√ìN
                 ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <div class="tab-pane fade" id="backup">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h1 class="h2 mb-0">
                        <i class="bi bi-cloud-download me-2"></i>Backup y Exportaci√≥n
                    </h1>
                    <small class="text-muted">
                        <i class="bi bi-info-circle me-1"></i>Descarga tus datos en formato Excel
                    </small>
                </div>

                <!-- Informaci√≥n General -->
                <div class="alert alert-info d-flex align-items-start mb-4">
                    <i class="bi bi-lightbulb-fill fs-4 me-3"></i>
                    <div>
                        <h6 class="alert-heading mb-2">¬øPara qu√© sirve esta secci√≥n?</h6>
                        <p class="mb-0 small">
                            Exporta tus datos a archivos Excel (.xlsx) para crear respaldos, an√°lisis externos,
                            o compartir informaci√≥n. Los archivos incluyen todos los datos actualizados al momento de la descarga.
                        </p>
                    </div>
                </div>

                <!-- Exportaciones Individuales -->
                <div class="row g-4 mb-4">
                    <!-- Exportar Inventario -->
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body text-center">
                                <div class="icon-badge bg-primary mb-3 mx-auto" style="width: 60px; height: 60px; line-height: 60px; font-size: 24px;">
                                    <i class="bi bi-boxes"></i>
                                </div>
                                <h5 class="card-title">Inventario</h5>
                                <p class="card-text text-muted small">
                                    Exporta todos los productos con variaciones, stock, precios y categor√≠as.
                                </p>
                                <button class="btn btn-primary w-100" id="export-inventario-btn">
                                    <i class="bi bi-download me-2"></i>Descargar
                                </button>
                                <div class="mt-2 small text-muted">
                                    <span id="export-inventario-count">0 productos</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Exportar Clientes -->
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body text-center">
                                <div class="icon-badge bg-success mb-3 mx-auto" style="width: 60px; height: 60px; line-height: 60px; font-size: 24px;">
                                    <i class="bi bi-people"></i>
                                </div>
                                <h5 class="card-title">Clientes</h5>
                                <p class="card-text text-muted small">
                                    Exporta la lista completa de clientes con datos de contacto.
                                </p>
                                <button class="btn btn-success w-100" id="export-clientes-btn">
                                    <i class="bi bi-download me-2"></i>Descargar
                                </button>
                                <div class="mt-2 small text-muted">
                                    <span id="export-clientes-count">0 clientes</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Exportar Ventas -->
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body text-center">
                                <div class="icon-badge bg-warning mb-3 mx-auto" style="width: 60px; height: 60px; line-height: 60px; font-size: 24px;">
                                    <i class="bi bi-receipt"></i>
                                </div>
                                <h5 class="card-title">Ventas</h5>
                                <p class="card-text text-muted small">
                                    Exporta el historial completo de ventas con detalles de productos.
                                </p>
                                <button class="btn btn-warning w-100" id="export-ventas-btn">
                                    <i class="bi bi-download me-2"></i>Descargar
                                </button>
                                <div class="mt-2 small text-muted">
                                    <span id="export-ventas-count">0 ventas</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Exportar Finanzas -->
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body text-center">
                                <div class="icon-badge bg-info mb-3 mx-auto" style="width: 60px; height: 60px; line-height: 60px; font-size: 24px;">
                                    <i class="bi bi-piggy-bank"></i>
                                </div>
                                <h5 class="card-title">Finanzas</h5>
                                <p class="card-text text-muted small">
                                    Exporta ingresos, gastos y cierres diarios para an√°lisis contable.
                                </p>
                                <button class="btn btn-info w-100" id="export-finanzas-btn">
                                    <i class="bi bi-download me-2"></i>Descargar
                                </button>
                                <div class="mt-2 small text-muted">
                                    <span id="export-finanzas-count">0 registros</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Exportar Apartados -->
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body text-center">
                                <div class="icon-badge bg-secondary mb-3 mx-auto" style="width: 60px; height: 60px; line-height: 60px; font-size: 24px;">
                                    <i class="bi bi-calendar-check"></i>
                                </div>
                                <h5 class="card-title">Apartados</h5>
                                <p class="card-text text-muted small">
                                    Exporta todos los apartados con estado, pagos y fechas.
                                </p>
                                <button class="btn btn-secondary w-100" id="export-apartados-btn">
                                    <i class="bi bi-download me-2"></i>Descargar
                                </button>
                                <div class="mt-2 small text-muted">
                                    <span id="export-apartados-count">0 apartados</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Exportar Pedidos Web -->
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body text-center">
                                <div class="icon-badge bg-danger mb-3 mx-auto" style="width: 60px; height: 60px; line-height: 60px; font-size: 24px;">
                                    <i class="bi bi-bag-check"></i>
                                </div>
                                <h5 class="card-title">Pedidos Web</h5>
                                <p class="card-text text-muted small">
                                    Exporta todos los pedidos realizados desde la tienda en l√≠nea.
                                </p>
                                <button class="btn btn-danger w-100" id="export-pedidos-btn">
                                    <i class="bi bi-download me-2"></i>Descargar
                                </button>
                                <div class="mt-2 small text-muted">
                                    <span id="export-pedidos-count">0 pedidos</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Backup Completo -->
                <div class="card shadow-sm border-primary">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">
                            <i class="bi bi-cloud-arrow-down-fill me-2"></i>Backup Completo
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h6 class="fw-bold">Descarga todo en un solo archivo</h6>
                                <p class="text-muted mb-0">
                                    Exporta todas las colecciones de la base de datos en un √∫nico archivo Excel con m√∫ltiples pesta√±as.
                                    Ideal para respaldos completos o migraci√≥n de datos.
                                </p>
                                <div class="mt-3">
                                    <small class="text-muted d-block">
                                        <i class="bi bi-check-circle-fill text-success me-1"></i>Incluye: Productos, Clientes, Ventas, Finanzas, Apartados, Pedidos, Categor√≠as y Proveedores
                                    </small>
                                </div>
                            </div>
                            <div class="col-md-4 text-center mt-3 mt-md-0">
                                <button class="btn btn-primary btn-lg w-100" id="export-backup-completo-btn">
                                    <i class="bi bi-cloud-download me-2"></i>Backup Completo
                                </button>
                                <div class="mt-2">
                                    <div class="spinner-border spinner-border-sm text-primary d-none" id="backup-spinner" role="status">
                                        <span class="visually-hidden">Exportando...</span>
                                    </div>
                                    <small class="text-muted d-block" id="backup-status"></small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Informaci√≥n Adicional -->
                <div class="card mt-4 border-0 bg-light">
                    <div class="card-body">
                        <h6 class="fw-bold mb-3"><i class="bi bi-info-circle me-2"></i>Informaci√≥n Importante</h6>
                        <ul class="mb-0 small">
                            <li class="mb-2">Los archivos se descargan en formato Excel (.xlsx) compatible con Microsoft Excel, Google Sheets y LibreOffice.</li>
                            <li class="mb-2">Los datos exportados reflejan el estado actual de la base de datos en el momento de la descarga.</li>
                            <li class="mb-2">Se recomienda realizar backups peri√≥dicos (semanales o mensuales) para mayor seguridad.</li>
                            <li class="mb-2">Los archivos incluyen formato de tabla con encabezados para facilitar la lectura y an√°lisis.</li>
                            <li>Las exportaciones son instant√°neas y no afectan el funcionamiento del sistema.</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- =====================================================
                 8Ô∏è‚É£ SECCI√ìN USUARIOS - GESTI√ìN DE USUARIOS Y PERMISOS
                 ===================================================== -->
            <div class="tab-pane fade" id="usuarios">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h1 class="h2 mb-0">
                        <i class="bi bi-person-lock me-2"></i>Gesti√≥n de Usuarios
                    </h1>
                    <button class="btn btn-primary" id="btn-add-usuario">
                        <i class="bi bi-person-plus me-2"></i>Nuevo Usuario
                    </button>
                </div>

                <!-- Alerta informativa -->
                <div class="alert alert-info d-flex align-items-start mb-4">
                    <i class="bi bi-info-circle-fill fs-4 me-3"></i>
                    <div>
                        <h6 class="alert-heading mb-2">Sistema de Permisos</h6>
                        <p class="mb-0 small">
                            Controla el acceso al panel de administraci√≥n creando usuarios con roles espec√≠ficos.
                            Cada usuario solo podr√° ver y modificar las secciones para las que tiene permiso.
                        </p>
                    </div>
                </div>

                <!-- Listado de Usuarios -->
                <div class="card shadow-sm">
                    <div class="card-header bg-white py-3">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <h5 class="mb-0">
                                    <i class="bi bi-people-fill me-2"></i>Usuarios del Sistema
                                </h5>
                            </div>
                            <div class="col-md-6">
                                <input
                                    type="search"
                                    class="form-control"
                                    id="search-usuarios"
                                    placeholder="üîç Buscar usuario..."
                                >
                            </div>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover align-middle mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th class="px-4">Usuario</th>
                                        <th>Email</th>
                                        <th>Rol</th>
                                        <th>Estado</th>
                                        <th>√öltimo Acceso</th>
                                        <th class="text-center">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="usuarios-table-body">
                                    <tr>
                                        <td colspan="6" class="text-center text-muted py-5">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">Cargando...</span>
                                            </div>
                                            <p class="mt-3 mb-0">Cargando usuarios...</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    </div><!-- /.admin-content-wrapper -->

    <div class="modal fade" id="addClientModal" tabindex="-1"> <div class="modal-dialog"> <div class="modal-content"> <div class="modal-header"> <h1 class="modal-title fs-5">Agregar Cliente</h1> <button type="button" class="btn-close" data-bs-dismiss="modal"></button> </div> <div class="modal-body"> <form id="form-add-client"> <div class="mb-3"> <label for="new-client-cedula" class="form-label">C√©dula:</label> <input type="text" class="form-control" id="new-client-cedula"> </div> <div class="mb-3"> <label for="new-client-nombre" class="form-label">Nombre:</label> <input type="text" class="form-control" id="new-client-nombre" required> </div> <div class="mb-3"> <label for="new-client-celular" class="form-label">Celular:</label> <input type="tel" class="form-control" id="new-client-celular" required> </div> <div class="mb-3"> <label for="new-client-direccion" class="form-label">Direcci√≥n:</label> <input type="text" class="form-control" id="new-client-direccion"> </div> </form> </div> <div class="modal-footer"> <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button> <button type="submit" form="form-add-client" class="btn btn-primary">Guardar</button> </div> </div> </div> </div>
    <div class="modal fade" id="addRepartidorModal" tabindex="-1"> <div class="modal-dialog"> <div class="modal-content"> <div class="modal-header"> <h1 class="modal-title fs-5">Agregar Repartidor</h1> <button type="button" class="btn-close" data-bs-dismiss="modal"></button> </div> <div class="modal-body"> <form id="form-add-repartidor"> <div class="mb-3"> <label for="new-repartidor-nombre" class="form-label">Nombre:</label> <input type="text" class="form-control" id="new-repartidor-nombre" required> </div> <div class="mb-3"> <label for="new-repartidor-celular" class="form-label">Celular:</label> <input type="tel" class="form-control" id="new-repartidor-celular" required> </div> </form> </div> <div class="modal-footer"> <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button> <button type="submit" form="form-add-repartidor" class="btn btn-primary">Guardar</button> </div> </div> </div> </div>
    <div class="modal fade" id="addIncomeModal" tabindex="-1"> <div class="modal-dialog"> <div class="modal-content"> <div class="modal-header"> <h1 class="modal-title fs-5">Ingreso Extra</h1> <button type="button" class="btn-close" data-bs-dismiss="modal"></button> </div> <div class="modal-body"> <form id="form-add-income"> <div class="mb-3"> <label for="income-amount" class="form-label">Monto ($):</label> <input type="text" inputmode="numeric" class="form-control" id="income-amount" required> </div> <div class="mb-3"> <label for="income-method" class="form-label">M√©todo de Pago:</label> <select class="form-select" id="income-method" required> <option value="efectivo" selected>üíµ Efectivo</option> <option value="transferencia">üí≥ Transferencia</option> </select> </div> <div class="mb-3"> <label for="income-description" class="form-label">Descripci√≥n:</label> <input type="text" class="form-control" id="income-description" required> </div> </form> </div> <div class="modal-footer"> <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button> <button type="submit" form="form-add-income" class="btn btn-primary">Guardar</button> </div> </div> </div> </div>
    <div class="modal fade" id="addExpenseModal" tabindex="-1"> <div class="modal-dialog"> <div class="modal-content"> <div class="modal-header"> <h1 class="modal-title fs-5">Gasto</h1> <button type="button" class="btn-close" data-bs-dismiss="modal"></button> </div> <div class="modal-body"> <form id="form-add-expense"> <div class="mb-3"> <label for="expense-amount" class="form-label">Monto ($):</label> <input type="text" inputmode="numeric" class="form-control" id="expense-amount" required> </div> <div class="mb-3"> <label for="expense-description" class="form-label">Descripci√≥n:</label> <input type="text" class="form-control" id="expense-description" required> </div> </form> </div> <div class="modal-footer"> <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button> <button type="submit" form="form-add-expense" class="btn btn-primary">Guardar</button> </div> </div> </div> </div>
    <div class="modal fade" id="addSupplierModal" tabindex="-1"> <div class="modal-dialog"> <div class="modal-content"> <div class="modal-header"> <h1 class="modal-title fs-5">Agregar Proveedor</h1> <button type="button" class="btn-close" data-bs-dismiss="modal"></button> </div> <div class="modal-body"> <form id="form-add-supplier"> <div class="mb-3"> <label for="new-supplier-nombre" class="form-label">Nombre:</label> <input type="text" class="form-control" id="new-supplier-nombre" required> </div> <div class="mb-3"> <label for="new-supplier-contacto" class="form-label">Contacto:</label> <input type="text" class="form-control" id="new-supplier-contacto"> </div> <div class="mb-3"> <label for="new-supplier-telefono" class="form-label">Tel√©fono:</label> <input type="tel" class="form-control" id="new-supplier-telefono"> </div> </form> </div> <div class="modal-footer"> <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button> <button type="submit" form="form-add-supplier" class="btn btn-primary">Guardar</button> </div> </div> </div> </div>
    <div class="modal fade" id="editCategoryModal" tabindex="-1"> <div class="modal-dialog"> <div class="modal-content"> <div class="modal-header"> <h1 class="modal-title fs-5">Editar Categor√≠a</h1> <button type="button" class="btn-close" data-bs-dismiss="modal"></button> </div> <div class="modal-body"> <form id="form-edit-category"> <input type="hidden" id="edit-category-id"> <div class="mb-3"> <label for="edit-category-nombre" class="form-label">Nuevo Nombre:</label> <input type="text" class="form-control" id="edit-category-nombre" required> </div> </form> </div> <div class="modal-footer"> <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button> <button type="submit" form="form-edit-category" class="btn btn-primary">Guardar Cambios</button> </div> </div> </div> </div>
    <div class="modal fade" id="editSupplierModal" tabindex="-1"> <div class="modal-dialog"> <div class="modal-content"> <div class="modal-header"> <h1 class="modal-title fs-5">Editar Proveedor</h1> <button type="button" class="btn-close" data-bs-dismiss="modal"></button> </div> <div class="modal-body"> <form id="form-edit-supplier"> <input type="hidden" id="edit-supplier-id"> <div class="mb-3"> <label for="edit-supplier-nombre" class="form-label">Nombre:</label> <input type="text" class="form-control" id="edit-supplier-nombre" required> </div> <div class="mb-3"> <label for="edit-supplier-contacto" class="form-label">Contacto:</label> <input type="text" class="form-control" id="edit-supplier-contacto"> </div> <div class="mb-3"> <label for="edit-supplier-telefono" class="form-label">Tel√©fono:</label> <input type="tel" class="form-control" id="edit-supplier-telefono"> </div> </form> </div> <div class="modal-footer"> <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button> <button type="submit" form="form-edit-supplier" class="btn btn-primary">Guardar</button> </div> </div> </div> </div>
    <div class="modal fade" id="editClientModal" tabindex="-1"> <div class="modal-dialog"> <div class="modal-content"> <div class="modal-header"> <h1 class="modal-title fs-5">Editar Cliente</h1> <button type="button" class="btn-close" data-bs-dismiss="modal"></button> </div> <div class="modal-body"> <form id="form-edit-client"> <input type="hidden" id="edit-client-id"> <div class="mb-3"> <label for="edit-client-cedula" class="form-label">C√©dula:</label> <input type="text" class="form-control" id="edit-client-cedula"> </div> <div class="mb-3"> <label for="edit-client-nombre" class="form-label">Nombre:</label> <input type="text" class="form-control" id="edit-client-nombre" required> </div> <div class="mb-3"> <label for="edit-client-celular" class="form-label">Celular:</label> <input type="tel" class="form-control" id="edit-client-celular" required> </div> <div class="mb-3"> <label for="edit-client-direccion" class="form-label">Direcci√≥n:</label> <input type="text" class="form-control" id="edit-client-direccion"> </div> </form> </div> <div class="modal-footer"> <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button> <button type="submit" form="form-edit-client" class="btn btn-primary">Guardar</button> </div> </div> </div> </div>
    <div class="modal fade" id="deleteConfirmModal" tabindex="-1"> <div class="modal-dialog modal-dialog-centered"> <div class="modal-content"> <div class="modal-header"> <h1 class="modal-title fs-5 text-danger"><i class="bi bi-exclamation-triangle-fill me-2"></i>Confirmar Eliminaci√≥n</h1> <button type="button" class="btn-close" data-bs-dismiss="modal"></button> </div> <div class="modal-body"> <p>¬øEst√°s seguro?</p> <p><strong id="delete-item-name"></strong></p> <small class="text-muted">No se puede deshacer.</small> </div> <div class="modal-footer"> <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button> <button type="button" class="btn btn-danger" id="confirm-delete-btn" data-delete-id="" data-delete-collection="">Confirmar</button> </div> </div> </div> </div>
    <div class="modal fade"id="liquidateConfirmModal" tabindex="-1"> <div class="modal-dialog modal-dialog-centered"> <div class="modal-content"> <div class="modal-header"> <h1 class="modal-title fs-5">Confirmar Liquidaci√≥n</h1> <button type="button" class="btn-close" data-bs-dismiss="modal"></button> </div> <div class="modal-body"> <p>¬øConfirmas que recibiste <strong id="liquidate-amount" class="text-success"></strong> del repartidor <strong id="liquidate-name"></strong>?</p> <p id="liquidate-saldo-text" class="fw-bold"></p> </div> <div class="modal-footer"> <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button> <button type="button" class="btn btn-primary" id="confirm-liquidate-btn" data-liquidate-id="">Confirmar</button> </div> </div> </div> </div>
    <div class="modal fade" id="searchSupplierModal" tabindex="-1"> <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable"> <div class="modal-content"> <div class="modal-header"> <h1 class="modal-title fs-5">Buscar Proveedor</h1> <button type="button" class="btn-close" data-bs-dismiss="modal"></button> </div> <div class="modal-body"> <input type="search" class="form-control mb-3" id="supplier-modal-search" placeholder="Buscar por nombre..."> <ul class="list-group search-modal-list" id="supplier-modal-list"> </ul> </div> </div> </div> </div>
    <div class="modal fade" id="searchClientModal" tabindex="-1"> <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable"> <div class="modal-content"> <div class="modal-header"> <h1 class="modal-title fs-5">Buscar Cliente</h1> <button type="button" class="btn-close" data-bs-dismiss="modal"></button> </div> <div class="modal-body"> <input type="search" class="form-control mb-3" id="client-modal-search" placeholder="Buscar por nombre o c√©dula..."> <ul class="list-group search-modal-list" id="client-modal-list"> </ul> </div> </div> </div> </div>
    
    <div class="modal fade" id="searchProductModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5">Buscar Producto</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Filtros Avanzados -->
                    <div class="row g-2 mb-3">
                        <div class="col-md-6">
                            <label class="form-label small fw-bold">Buscar por nombre o c√≥digo:</label>
                            <div class="input-group input-group-sm">
                                <span class="input-group-text"><i class="bi bi-search"></i></span>
                                <input type="search" class="form-control" id="product-modal-search" placeholder="Buscar...">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label small fw-bold">Categor√≠a:</label>
                            <select class="form-select form-select-sm" id="product-modal-category">
                                <option value="">Todas las categor√≠as</option>
                            </select>
                        </div>
                        <div class="col-md-2 d-flex align-items-end">
                            <button type="button" class="btn btn-sm btn-outline-secondary w-100" id="product-modal-clear-filters">
                                <i class="bi bi-x-circle"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Filtros adicionales -->
                    <div class="row g-2 mb-3">
                        <div class="col-md-4">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="product-modal-stock-only">
                                <label class="form-check-label small" for="product-modal-stock-only">
                                    Solo con stock disponible
                                </label>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="product-modal-visible-only">
                                <label class="form-check-label small" for="product-modal-visible-only">
                                    Solo productos visibles
                                </label>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label small fw-bold">Ordenar por:</label>
                            <select class="form-select form-select-sm" id="product-modal-sort">
                                <option value="name-asc">Nombre A-Z</option>
                                <option value="name-desc">Nombre Z-A</option>
                                <option value="price-asc">Precio ‚Üë</option>
                                <option value="price-desc">Precio ‚Üì</option>
                                <option value="stock-desc">Mayor stock</option>
                            </select>
                        </div>
                    </div>

                    <hr>

                    <!-- Lista de productos -->
                    <div id="product-modal-count" class="mb-2 text-muted small"></div>
                    <ul class="list-group search-modal-list" id="product-modal-list">
                        <li class="list-group-item text-center text-muted">
                            <i class="bi bi-search"></i> Usa los filtros para buscar productos
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="selectVariationModal" tabindex="-1" aria-labelledby="selectVariationModalTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="selectVariationModalTitle">Seleccionar Variaci√≥n</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="variation-product-id">
                    <input type="hidden" id="variation-product-name">
                    <input type="hidden" id="variation-product-price">
                    
                    <div id="variation-options-container">
                        </div>
                    
                    <div id="variation-stock-display" class="alert alert-light text-center mt-3" style="display: none;">
                        Stock disponible: <span class="fw-bold">0</span>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="add-variation-to-cart-btn" disabled>A√±adir al Carrito</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="viewSaleModal" tabindex="-1" aria-labelledby="viewSaleModalTitle" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="viewSaleModalTitle">Detalle de Venta</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="viewSaleModalBody">
                    <div class="text-center">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Cargando...</span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" id="btn-delete-sale">
                        <i class="bi bi-trash"></i> Eliminar Venta
                    </button>
                    <button type="button" class="btn btn-warning" id="btn-edit-sale">
                        <i class="bi bi-pencil"></i> Editar Venta
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         MODAL: EDITAR VENTA
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="modal fade" id="editSaleModal" tabindex="-1" aria-labelledby="editSaleModalTitle" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header bg-warning text-dark">
                    <h1 class="modal-title fs-5" id="editSaleModalTitle">
                        <i class="bi bi-pencil-square me-2"></i>Editar Venta
                    </h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="edit-sale-id">

                    <!-- Informaci√≥n de la Venta -->
                    <div class="alert alert-info mb-3">
                        <strong><i class="bi bi-info-circle me-2"></i>Folio:</strong> <span id="edit-sale-folio"></span><br>
                        <strong><i class="bi bi-calendar3 me-2"></i>Fecha:</strong> <span id="edit-sale-date"></span>
                    </div>

                    <!-- Cliente -->
                    <div class="mb-3">
                        <label for="edit-sale-cliente" class="form-label">
                            <i class="bi bi-person me-2"></i>Cliente
                        </label>
                        <input type="text" class="form-control" id="edit-sale-cliente" readonly>
                    </div>

                    <!-- Tipo de Venta -->
                    <div class="mb-3">
                        <label for="edit-sale-tipo" class="form-label">
                            <i class="bi bi-tag me-2"></i>Tipo de Venta
                        </label>
                        <select class="form-select" id="edit-sale-tipo">
                            <option value="detal">Detal</option>
                            <option value="mayorista">Mayorista</option>
                            <option value="apartado">Apartado</option>
                        </select>
                        <small class="text-muted">Cambiar el tipo recalcular√° los precios autom√°ticamente</small>
                    </div>

                    <!-- Productos -->
                    <div class="mb-3">
                        <label class="form-label">
                            <i class="bi bi-box-seam me-2"></i>Productos
                        </label>
                        <div id="edit-sale-productos" class="border rounded p-3">
                            <!-- Los productos se cargar√°n aqu√≠ -->
                        </div>
                    </div>

                    <!-- M√©todo de Pago -->
                    <div class="mb-3">
                        <label for="edit-sale-pago" class="form-label">
                            <i class="bi bi-credit-card me-2"></i>M√©todo de Pago
                        </label>
                        <select class="form-select" id="edit-sale-pago">
                            <option value="efectivo">Efectivo</option>
                            <option value="transferencia">Transferencia</option>
                            <option value="tarjeta">Tarjeta</option>
                            <option value="otro">Otro</option>
                        </select>
                    </div>

                    <!-- Repartidor (si aplica) -->
                    <div class="mb-3" id="edit-sale-repartidor-container">
                        <label for="edit-sale-repartidor" class="form-label">
                            <i class="bi bi-bicycle me-2"></i>Repartidor
                        </label>
                        <select class="form-select" id="edit-sale-repartidor">
                            <option value="">Ninguno</option>
                            <!-- Los repartidores se cargar√°n din√°micamente -->
                        </select>
                    </div>

                    <!-- Total Actualizado -->
                    <div class="alert alert-success mb-0">
                        <div class="d-flex justify-content-between align-items-center">
                            <strong><i class="bi bi-cash-stack me-2"></i>Total:</strong>
                            <h4 class="mb-0" id="edit-sale-total">$0.00</h4>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="bi bi-x-circle me-1"></i>Cancelar
                    </button>
                    <button type="button" class="btn btn-primary" id="btn-save-edit-sale">
                        <i class="bi bi-check-circle me-1"></i>Guardar Cambios
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         MODAL: ELIMINAR VENTA CON CONTRASE√ëA
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="modal fade" id="deleteSaleModal" tabindex="-1" aria-labelledby="deleteSaleModalTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h1 class="modal-title fs-5" id="deleteSaleModalTitle">
                        <i class="bi bi-trash me-2"></i>Eliminar Venta
                    </h1>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="delete-sale-id">

                    <div class="alert alert-danger">
                        <i class="bi bi-exclamation-triangle-fill me-2"></i>
                        <strong>¬°ATENCI√ìN!</strong> Esta acci√≥n eliminar√° permanentemente la venta de la base de datos.
                    </div>

                    <div class="mb-3">
                        <strong>Folio:</strong> <span id="delete-sale-folio"></span><br>
                        <strong>Cliente:</strong> <span id="delete-sale-cliente"></span><br>
                        <strong>Total:</strong> <span id="delete-sale-total"></span>
                    </div>

                    <div class="mb-3">
                        <label for="delete-sale-password" class="form-label">
                            <i class="bi bi-shield-lock me-2"></i>Contrase√±a de Administrador
                        </label>
                        <input type="password" class="form-control" id="delete-sale-password"
                               placeholder="Ingresa la contrase√±a para confirmar" required>
                        <small class="text-muted">Se requiere contrase√±a para eliminar ventas</small>
                    </div>

                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="delete-sale-confirm">
                        <label class="form-check-label" for="delete-sale-confirm">
                            Confirmo que quiero eliminar esta venta permanentemente
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="bi bi-x-circle me-1"></i>Cancelar
                    </button>
                    <button type="button" class="btn btn-danger" id="btn-confirm-delete-sale" disabled>
                        <i class="bi bi-trash me-1"></i>Eliminar Definitivamente
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <!-- Modal de Gesti√≥n de Promociones -->
    <div class="modal fade" id="promoModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-tag-fill me-2"></i>Gestionar Promoci√≥n
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="promo-product-id">
                    <input type="hidden" id="promo-product-price">

                    <div class="mb-3">
                        <h6 id="promo-product-name" class="text-primary"></h6>
                        <small class="text-muted">Precio normal: <strong id="promo-price-normal"></strong></small>
                    </div>

                    <div class="mb-3">
                        <div class="form-check form-switch d-flex align-items-center justify-content-between">
                            <label class="form-check-label mb-0" for="promo-active">
                                <strong>Promoci√≥n Activa</strong>
                            </label>
                            <input class="form-check-input ms-2" type="checkbox" id="promo-active">
                        </div>
                        <small class="text-muted d-block mt-1">Activa o desactiva la promoci√≥n en la tienda</small>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">Tipo de Promoci√≥n</label>
                        <div class="btn-group w-100" role="group">
                            <input type="radio" class="btn-check" name="promo-type" id="promo-type-percentage" value="percentage" checked>
                            <label class="btn btn-outline-primary" for="promo-type-percentage">
                                <i class="bi bi-percent"></i> Descuento %
                            </label>

                            <input type="radio" class="btn-check" name="promo-type" id="promo-type-fixed" value="fixed">
                            <label class="btn btn-outline-primary" for="promo-type-fixed">
                                <i class="bi bi-cash"></i> Precio Fijo
                            </label>
                        </div>
                    </div>

                    <div id="promo-percentage-section">
                        <div class="mb-3">
                            <label for="promo-discount-percentage" class="form-label">Descuento (%)</label>
                            <div class="input-group">
                                <input type="number" class="form-control" id="promo-discount-percentage"
                                       min="1" max="100" value="10" step="1">
                                <span class="input-group-text">%</span>
                            </div>
                            <div class="form-text">Precio final: <strong id="promo-final-price-percentage">$0</strong></div>
                        </div>
                    </div>

                    <div id="promo-fixed-section" style="display: none;">
                        <div class="mb-3">
                            <label for="promo-fixed-price" class="form-label">Precio Promocional</label>
                            <div class="input-group">
                                <span class="input-group-text">$</span>
                                <input type="number" class="form-control" id="promo-fixed-price"
                                       min="0" step="1000" placeholder="Ej: 25000">
                            </div>
                            <div class="form-text">Ahorro: <strong id="promo-savings-fixed">$0</strong></div>
                        </div>
                    </div>

                    <div class="alert alert-info mb-0">
                        <i class="bi bi-info-circle me-2"></i>
                        <strong>Importante:</strong> La promoci√≥n se aplicar√° autom√°ticamente en el cat√°logo web.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-danger" id="btn-remove-promo" style="display: none;">
                        <i class="bi bi-trash"></i> Quitar Promoci√≥n
                    </button>
                    <button type="button" class="btn btn-primary" id="btn-save-promo">
                        <i class="bi bi-check-lg"></i> Guardar Promoci√≥n
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Bajo Stock -->
    <div class="modal fade" id="bajoStockModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-exclamation-triangle text-warning me-2"></i>Productos con Bajo Stock
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="text-muted mb-3">Productos con 2 unidades o menos en inventario</p>
                    <div class="table-responsive">
                        <table class="table table-hover align-middle">
                            <thead class="table-light">
                                <tr>
                                    <th>Producto</th>
                                    <th>Variaci√≥n</th>
                                    <th class="text-center">Stock</th>
                                    <th>Categor√≠a</th>
                                </tr>
                            </thead>
                            <tbody id="bajo-stock-list">
                                <tr>
                                    <td colspan="4" class="text-center text-muted">Cargando...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Historial de Compras por Cliente -->
    <div class="modal fade" id="clientHistoryModal" tabindex="-1">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">
                        <i class="bi bi-clock-history me-2"></i>Historial de Compras - <span id="client-history-name"></span>
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Estad√≠sticas del Cliente -->
                    <div class="row g-3 mb-4">
                        <div class="col-md-3">
                            <div class="card text-center">
                                <div class="card-body">
                                    <i class="bi bi-cash-stack text-success" style="font-size: 2rem;"></i>
                                    <h6 class="mt-2 mb-1 text-muted">Total Gastado</h6>
                                    <h4 class="mb-0 text-success" id="client-total-spent">$0</h4>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card text-center">
                                <div class="card-body">
                                    <i class="bi bi-cart-check text-primary" style="font-size: 2rem;"></i>
                                    <h6 class="mt-2 mb-1 text-muted">Total Compras</h6>
                                    <h4 class="mb-0 text-primary" id="client-total-purchases">0</h4>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card text-center">
                                <div class="card-body">
                                    <i class="bi bi-calendar-event text-info" style="font-size: 2rem;"></i>
                                    <h6 class="mt-2 mb-1 text-muted">√öltima Compra</h6>
                                    <h6 class="mb-0 text-info" id="client-last-purchase">-</h6>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card text-center">
                                <div class="card-body">
                                    <i class="bi bi-graph-up text-warning" style="font-size: 2rem;"></i>
                                    <h6 class="mt-2 mb-1 text-muted">Ticket Promedio</h6>
                                    <h4 class="mb-0 text-warning" id="client-avg-ticket">$0</h4>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tabla de Compras -->
                    <div class="table-responsive">
                        <table class="table table-hover align-middle">
                            <thead class="table-light">
                                <tr>
                                    <th>Fecha</th>
                                    <th>Productos</th>
                                    <th>Total</th>
                                    <th>M√©todo Pago</th>
                                    <th>Estado</th>
                                    <th>Tipo</th>
                                </tr>
                            </thead>
                            <tbody id="client-history-list">
                                <tr>
                                    <td colspan="6" class="text-center text-muted py-4">
                                        <div class="spinner-border text-primary" role="status">
                                            <span class="visually-hidden">Cargando...</span>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Inversi√≥n Total en Inventario -->
    <div class="modal fade" id="inversionInventarioModal" tabindex="-1">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title">
                        <i class="bi bi-cash-stack me-2"></i>Inversi√≥n Total en Inventario - An√°lisis Detallado
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Resumen Principal -->
                    <div class="alert alert-success mb-4">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <h4 class="mb-2">
                                    <i class="bi bi-wallet2 me-2"></i>Inversi√≥n Total
                                </h4>
                                <h2 class="mb-0 fw-bold" id="modal-inversion-total">$0</h2>
                                <small class="text-muted">Suma de todos los costos de productos en inventario</small>
                            </div>
                            <div class="col-md-6">
                                <h4 class="mb-2">
                                    <i class="bi bi-box-seam me-2"></i>Total de Unidades
                                </h4>
                                <h2 class="mb-0 fw-bold" id="modal-inventario-unidades">0</h2>
                                <small class="text-muted">Cantidad total de productos en stock</small>
                            </div>
                        </div>
                    </div>

                    <!-- Explicaci√≥n Detallada -->
                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <h6 class="mb-0"><i class="bi bi-info-circle me-2"></i>¬øQu√© representa esta m√©trica?</h6>
                        </div>
                        <div class="card-body">
                            <p class="mb-3">
                                La <strong>Inversi√≥n Total en Inventario</strong> representa el capital total que has invertido
                                en la compra de todos los productos que actualmente tienes disponibles en tu boutique.
                            </p>
                            <p class="mb-3">
                                <strong>C√°lculo:</strong> Se suma el <em>precio de costo</em> de cada producto multiplicado
                                por la cantidad de unidades disponibles en stock.
                            </p>
                            <div class="alert alert-info mb-0">
                                <strong>F√≥rmula:</strong><br>
                                <code>Inversi√≥n Total = Œ£ (Precio Costo √ó Cantidad en Stock)</code>
                            </div>
                        </div>
                    </div>

                    <!-- M√©tricas Derivadas -->
                    <div class="row g-3 mb-4">
                        <div class="col-md-4">
                            <div class="card text-center h-100">
                                <div class="card-body">
                                    <i class="bi bi-calculator text-primary" style="font-size: 2.5rem;"></i>
                                    <h6 class="mt-3 mb-2 text-muted">Inversi√≥n Promedio por Producto</h6>
                                    <h4 class="mb-2 text-primary" id="modal-inversion-promedio">$0</h4>
                                    <small class="text-muted">Total inversi√≥n √∑ Total productos</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card text-center h-100">
                                <div class="card-body">
                                    <i class="bi bi-box text-warning" style="font-size: 2.5rem;"></i>
                                    <h6 class="mt-3 mb-2 text-muted">Inversi√≥n Promedio por Unidad</h6>
                                    <h4 class="mb-2 text-warning" id="modal-inversion-por-unidad">$0</h4>
                                    <small class="text-muted">Total inversi√≥n √∑ Total unidades</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card text-center h-100">
                                <div class="card-body">
                                    <i class="bi bi-percent text-info" style="font-size: 2.5rem;"></i>
                                    <h6 class="mt-3 mb-2 text-muted">Rotaci√≥n Estimada</h6>
                                    <h4 class="mb-2 text-info" id="modal-rotacion-inventario">0%</h4>
                                    <small class="text-muted">Basado en ventas recientes</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Importancia y Recomendaciones -->
                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <h6 class="mb-0"><i class="bi bi-lightbulb me-2"></i>¬øPor qu√© es importante?</h6>
                        </div>
                        <div class="card-body">
                            <ul class="mb-3">
                                <li class="mb-2">
                                    <strong>Control de Capital:</strong> Te permite saber cu√°nto dinero tienes "congelado"
                                    en inventario que podr√≠a usarse para otras inversiones.
                                </li>
                                <li class="mb-2">
                                    <strong>Planificaci√≥n Financiera:</strong> Ayuda a planificar futuras compras y mantener
                                    un balance saludable entre inversi√≥n y liquidez.
                                </li>
                                <li class="mb-2">
                                    <strong>An√°lisis de Riesgo:</strong> Un inventario muy alto puede representar riesgo
                                    si los productos no se venden r√°pidamente.
                                </li>
                                <li class="mb-2">
                                    <strong>Proyecci√≥n de Utilidades:</strong> Junto con los precios de venta, te permite
                                    calcular las utilidades potenciales si vendes todo el inventario.
                                </li>
                            </ul>
                        </div>
                    </div>

                    <!-- Consejos Pr√°cticos -->
                    <div class="card border-primary">
                        <div class="card-header bg-primary text-white">
                            <h6 class="mb-0"><i class="bi bi-star me-2"></i>Consejos para Optimizar tu Inversi√≥n</h6>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <h6 class="text-success"><i class="bi bi-check-circle me-2"></i>Buenas Pr√°cticas</h6>
                                    <ul class="small">
                                        <li>Mant√©n un balance entre variedad y cantidad</li>
                                        <li>Monitorea productos de baja rotaci√≥n</li>
                                        <li>Aprovecha descuentos por volumen con proveedores</li>
                                        <li>Considera la estacionalidad de tus productos</li>
                                        <li>Realiza inventarios peri√≥dicos para verificar datos</li>
                                    </ul>
                                </div>
                                <div class="col-md-6">
                                    <h6 class="text-warning"><i class="bi bi-exclamation-triangle me-2"></i>Se√±ales de Alerta</h6>
                                    <ul class="small">
                                        <li>Inversi√≥n muy alta sin rotaci√≥n proporcional</li>
                                        <li>Productos en stock por m√°s de 6 meses</li>
                                        <li>Falta de liquidez por exceso de inventario</li>
                                        <li>Productos obsoletos o de temporadas pasadas</li>
                                        <li>Descuadres frecuentes en el conteo f√≠sico</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Utilidad Potencial (Detal) -->
    <div class="modal fade" id="utilidadPotencialModal" tabindex="-1">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <h5 class="modal-title">
                        <i class="bi bi-graph-up-arrow me-2"></i>Utilidad Potencial (Detal) - An√°lisis Detallado
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Resumen Principal -->
                    <div class="alert mb-4" style="background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%); border-color: #667eea;">
                        <div class="row align-items-center">
                            <div class="col-md-4">
                                <h5 class="mb-2">
                                    <i class="bi bi-piggy-bank me-2"></i>Utilidad Potencial
                                </h5>
                                <h2 class="mb-0 fw-bold text-success" id="modal-utilidad-total">$0</h2>
                                <small class="text-muted">Si vendes todo a precio de detal</small>
                            </div>
                            <div class="col-md-4">
                                <h5 class="mb-2">
                                    <i class="bi bi-percent me-2"></i>Margen de Utilidad
                                </h5>
                                <h2 class="mb-0 fw-bold" style="color: #667eea;" id="modal-margen-porcentaje">0%</h2>
                                <small class="text-muted">Porcentaje sobre la inversi√≥n</small>
                            </div>
                            <div class="col-md-4">
                                <h5 class="mb-2">
                                    <i class="bi bi-currency-dollar me-2"></i>ROI Esperado
                                </h5>
                                <h2 class="mb-0 fw-bold text-primary" id="modal-roi">0%</h2>
                                <small class="text-muted">Retorno sobre inversi√≥n</small>
                            </div>
                        </div>
                    </div>

                    <!-- Explicaci√≥n Detallada -->
                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <h6 class="mb-0"><i class="bi bi-info-circle me-2"></i>¬øQu√© representa esta m√©trica?</h6>
                        </div>
                        <div class="card-body">
                            <p class="mb-3">
                                La <strong>Utilidad Potencial (Detal)</strong> representa la ganancia total que obtendr√≠as
                                si vendieras todo tu inventario actual a los precios de venta al p√∫blico (precio de detal)
                                que tienes establecidos.
                            </p>
                            <p class="mb-3">
                                <strong>C√°lculo:</strong> Se resta la inversi√≥n total (costos) del valor total de venta
                                (precio detal √ó cantidad).
                            </p>
                            <div class="alert alert-info mb-3">
                                <strong>F√≥rmula:</strong><br>
                                <code>Utilidad Potencial = Œ£[(Precio Detal - Precio Costo) √ó Cantidad] </code><br>
                                <code>Margen (%) = (Utilidad Potencial √∑ Inversi√≥n Total) √ó 100</code>
                            </div>
                            <div class="alert alert-warning mb-0">
                                <i class="bi bi-exclamation-triangle me-2"></i><strong>Nota Importante:</strong>
                                Esta es una utilidad "potencial" o te√≥rica. En la pr√°ctica, pueden aplicarse descuentos,
                                promociones, o algunos productos pueden no venderse completamente.
                            </div>
                        </div>
                    </div>

                    <!-- Desglose de Utilidades -->
                    <div class="row g-3 mb-4">
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-header bg-success text-white">
                                    <h6 class="mb-0"><i class="bi bi-arrow-up-circle me-2"></i>Valor Total de Venta</h6>
                                </div>
                                <div class="card-body text-center">
                                    <h3 class="text-success mb-2" id="modal-valor-venta-total">$0</h3>
                                    <p class="mb-0 small text-muted">
                                        Suma de todos los productos a precio de detal
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-header bg-danger text-white">
                                    <h6 class="mb-0"><i class="bi bi-arrow-down-circle me-2"></i>Inversi√≥n Total</h6>
                                </div>
                                <div class="card-body text-center">
                                    <h3 class="text-danger mb-2" id="modal-inversion-total-utilidad">$0</h3>
                                    <p class="mb-0 small text-muted">
                                        Suma de todos los costos de productos
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- An√°lisis por Categor√≠a/Producto M√°s Rentable -->
                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <h6 class="mb-0"><i class="bi bi-trophy me-2"></i>Productos con Mayor Utilidad Potencial</h6>
                        </div>
                        <div class="card-body">
                            <div id="modal-top-productos-rentables">
                                <p class="text-muted text-center">Cargando an√°lisis de productos...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Importancia y Uso -->
                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <h6 class="mb-0"><i class="bi bi-lightbulb me-2"></i>¬øPor qu√© es importante?</h6>
                        </div>
                        <div class="card-body">
                            <ul class="mb-3">
                                <li class="mb-2">
                                    <strong>Visi√≥n del Potencial de Negocio:</strong> Te muestra el m√°ximo rendimiento
                                    que podr√≠as obtener de tu inventario actual.
                                </li>
                                <li class="mb-2">
                                    <strong>Evaluaci√≥n de Estrategia de Precios:</strong> Ayuda a determinar si tus
                                    m√°rgenes de ganancia son saludables para el negocio.
                                </li>
                                <li class="mb-2">
                                    <strong>Planificaci√≥n de Flujo de Caja:</strong> Permite proyectar ingresos futuros
                                    y planificar reinversiones o gastos.
                                </li>
                                <li class="mb-2">
                                    <strong>Toma de Decisiones:</strong> Ayuda a decidir si es momento de hacer
                                    promociones, liquidaciones, o comprar m√°s inventario.
                                </li>
                                <li class="mb-2">
                                    <strong>Salud Financiera:</strong> Un margen saludable (generalmente 40-60% en boutiques)
                                    indica que el negocio es sostenible y rentable.
                                </li>
                            </ul>
                        </div>
                    </div>

                    <!-- Estrategias para Maximizar Utilidades -->
                    <div class="card border-success">
                        <div class="card-header bg-success text-white">
                            <h6 class="mb-0"><i class="bi bi-graph-up me-2"></i>Estrategias para Maximizar tus Utilidades</h6>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <h6 class="text-primary"><i class="bi bi-rocket me-2"></i>Aumentar Utilidades</h6>
                                    <ul class="small">
                                        <li>Negocia mejores precios con tus proveedores</li>
                                        <li>Enf√≥cate en productos de alto margen</li>
                                        <li>Implementa estrategias de venta cruzada (cross-selling)</li>
                                        <li>Crea paquetes o combos atractivos</li>
                                        <li>Mejora la experiencia de compra para justificar precios</li>
                                        <li>Considera aumentos graduales en productos populares</li>
                                    </ul>
                                </div>
                                <div class="col-md-6">
                                    <h6 class="text-info"><i class="bi bi-speedometer2 me-2"></i>Acelerar Ventas</h6>
                                    <ul class="small">
                                        <li>Identifica y promociona productos de alta rotaci√≥n</li>
                                        <li>Crea urgencia con ofertas por tiempo limitado</li>
                                        <li>Usa redes sociales para mostrar tu inventario</li>
                                        <li>Implementa programas de fidelizaci√≥n</li>
                                        <li>Ofrece descuentos escalonados por volumen</li>
                                        <li>Organiza eventos o lanzamientos especiales</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Rangos de Referencia -->
                    <div class="card mt-4 border-info">
                        <div class="card-header bg-info text-white">
                            <h6 class="mb-0"><i class="bi bi-bar-chart me-2"></i>Rangos de Margen de Referencia</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-3 text-center mb-3">
                                    <div class="badge bg-danger mb-2" style="font-size: 1rem;">Bajo</div>
                                    <p class="mb-0 fw-bold">0% - 30%</p>
                                    <small class="text-muted">Margen insuficiente</small>
                                </div>
                                <div class="col-md-3 text-center mb-3">
                                    <div class="badge bg-warning mb-2" style="font-size: 1rem;">Regular</div>
                                    <p class="mb-0 fw-bold">30% - 50%</p>
                                    <small class="text-muted">Margen aceptable</small>
                                </div>
                                <div class="col-md-3 text-center mb-3">
                                    <div class="badge bg-success mb-2" style="font-size: 1rem;">Bueno</div>
                                    <p class="mb-0 fw-bold">50% - 70%</p>
                                    <small class="text-muted">Margen saludable</small>
                                </div>
                                <div class="col-md-3 text-center mb-3">
                                    <div class="badge bg-primary mb-2" style="font-size: 1rem;">Excelente</div>
                                    <p class="mb-0 fw-bold">70%+</p>
                                    <small class="text-muted">Margen √≥ptimo</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para agregar costo de domicilio antes de enviar WhatsApp -->
    <div class="modal fade" id="deliveryCostModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header" style="background: linear-gradient(135deg, #25D366 0%, #128C7E 100%); color: white;">
                    <h5 class="modal-title">
                        <i class="bi bi-whatsapp me-2"></i>Confirmar Pedido por WhatsApp
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle me-2"></i>
                        Ingresa el costo de domicilio antes de enviar la confirmaci√≥n al cliente
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">
                            <i class="bi bi-truck me-1"></i>Costo de Domicilio
                        </label>
                        <input type="number" class="form-control form-control-lg" id="delivery-cost-input"
                               placeholder="Ej: 3000" min="0" value="0">
                        <small class="text-muted">Deja en 0 si no aplica costo de env√≠o</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">
                            <i class="bi bi-person-badge me-1"></i>Repartidor
                        </label>
                        <select class="form-select form-select-lg" id="delivery-person-select">
                            <option value="">Cargando...</option>
                        </select>
                        <small class="text-muted">Los repartidores se cargan desde la base de datos</small>
                    </div>
                    <div id="order-summary-preview" class="border rounded p-3 bg-light">
                        <!-- Se llenar√° din√°micamente con JS -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="bi bi-x-circle me-1"></i>Cancelar
                    </button>
                    <button type="button" class="btn btn-success" id="confirm-whatsapp-btn" style="background: #25D366; border-color: #25D366;">
                        <i class="bi bi-whatsapp me-1"></i>Enviar WhatsApp
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- SheetJS para exportaci√≥n a Excel -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>

    <!-- Chart.js para gr√°ficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <!-- jsPDF para generar PDFs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- Script para manejar el sidebar toggle en m√≥vil (funciona independientemente) -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const sidebarToggle = document.getElementById('sidebarToggle');
            const sidebar = document.getElementById('adminSidebar');
            
            if (sidebarToggle && sidebar) {
                // Toggle sidebar al hacer click en el bot√≥n
                sidebarToggle.addEventListener('click', function(e) {
                    e.stopPropagation();
                    e.preventDefault();
                    sidebar.classList.toggle('show');
                    document.body.classList.toggle('sidebar-open');
                });
                
                // Cerrar sidebar al hacer click fuera (en el overlay)
                document.addEventListener('click', function(e) {
                    if (sidebar.classList.contains('show') &&
                        !sidebar.contains(e.target) &&
                        !sidebarToggle.contains(e.target)) {
                        sidebar.classList.remove('show');
                        document.body.classList.remove('sidebar-open');
                    }
                });
                
                // Cerrar sidebar al hacer click en un link de navegaci√≥n
                const navLinks = sidebar.querySelectorAll('.nav-link[data-bs-toggle="pill"], .dropdown-item[data-bs-toggle="pill"]');
                navLinks.forEach(function(link) {
                    link.addEventListener('click', function() {
                        if (window.innerWidth < 992) {
                            sidebar.classList.remove('show');
                            document.body.classList.remove('sidebar-open');
                        }
                    });
                });
            }
        });
    </script>

    <script type="module" src="admin.js?v=3.3.1"></script>

    <!-- Script para generar cat√°logo en PDF -->
    <script type="module" src="catalogoPDF.js?v=1.0.0"></script>

    <!-- Script para cerrar navegaci√≥n m√≥vil al hacer clic en un enlace -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Cerrar el men√∫ m√≥vil al hacer clic en cualquier enlace de navegaci√≥n
            const navLinks = document.querySelectorAll('.nav-pills .nav-link');
            const navbarCollapse = document.getElementById('adminNavbarContent');

            navLinks.forEach(link => {
                link.addEventListener('click', function() {
                    // Solo cerrar en m√≥vil (cuando el navbar est√° colapsado)
                    if (window.innerWidth < 992 && navbarCollapse.classList.contains('show')) {
                        // Usar Bootstrap para cerrar el collapse
                        const bsCollapse = bootstrap.Collapse.getInstance(navbarCollapse);
                        if (bsCollapse) {
                            bsCollapse.hide();
                        }
                    }
                });
            });
        });
    </script>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         MODAL: AGREGAR/EDITAR PROMOCI√ìN GLOBAL
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="modal fade" id="addPromocionGlobalModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-tag-fill me-2"></i>Nueva Promoci√≥n Global</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="form-add-promocion-global">
                        <div class="mb-3">
                            <label for="promo-nombre" class="form-label">Nombre de la Promoci√≥n</label>
                            <input type="text" class="form-control" id="promo-nombre" placeholder="Ej: Black Friday" required>
                            <small class="text-muted">Este nombre se mostrar√° en el banner de la tienda</small>
                        </div>

                        <div class="mb-3">
                            <label for="promo-descuento" class="form-label">Descuento (%)</label>
                            <input type="number" class="form-control" id="promo-descuento" min="1" max="99" placeholder="Ej: 10" required>
                            <small class="text-muted">Porcentaje de descuento para toda la tienda</small>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="promo-fecha-inicio" class="form-label">Fecha de Inicio</label>
                                <input type="datetime-local" class="form-control" id="promo-fecha-inicio" required>
                            </div>
                            <div class="col-md-6">
                                <label for="promo-fecha-fin" class="form-label">Fecha de Fin</label>
                                <input type="datetime-local" class="form-control" id="promo-fecha-fin" required>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="promo-tema" class="form-label">Tema Visual</label>
                            <select class="form-select" id="promo-tema" required>
                                <option value="default">Predeterminado</option>
                                <option value="blackfriday" selected>Black Friday (Negro/Rojo)</option>
                                <option value="navidad">Navidad (Rojo/Verde)</option>
                                <option value="aniversario">Aniversario</option>
                            </select>
                            <small class="text-muted">Elige el tema visual que se aplicar√° a la tienda</small>
                        </div>

                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="promo-activa" checked>
                            <label class="form-check-label" for="promo-activa">
                                <strong>Activar promoci√≥n</strong>
                            </label>
                        </div>

                        <div class="alert alert-warning">
                            <i class="bi bi-exclamation-triangle me-2"></i>
                            <strong>Importante:</strong> Esta promoci√≥n se aplicar√° a todos los productos de la tienda que no tengan una promoci√≥n individual activa.
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" form="form-add-promocion-global" class="btn btn-primary">
                        <i class="bi bi-check-circle me-1"></i> Guardar Promoci√≥n
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- üì¶ MODAL PARA GENERAR Y VER C√ìDIGO DE BARRAS -->
    <div class="modal fade" id="barcodeModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-upc-scan"></i> C√≥digo de Barras</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <div id="barcode-info" class="mb-3">
                        <h6 id="barcode-product-name" class="fw-bold"></h6>
                        <p id="barcode-product-code" class="text-muted small mb-1"></p>
                        <p id="barcode-product-price" class="fw-bold text-primary mb-3"></p>
                    </div>
                    <div id="barcode-display" class="p-4 bg-white border rounded">
                        <svg id="barcode-svg"></svg>
                        <p id="barcode-number" class="mt-2 fw-bold"></p>
                    </div>
                    <div class="mt-3">
                        <button type="button" class="btn btn-primary" onclick="window.print()"><i class="bi bi-printer"></i> Imprimir Etiqueta</button>
                        <button type="button" class="btn btn-outline-secondary" onclick="window.downloadBarcode()"><i class="bi bi-download"></i> Descargar PNG</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================
         MODALES DE GESTI√ìN DE USUARIOS
         ============================================ -->

    <!-- Modal: Agregar/Editar Usuario -->
    <div class="modal fade" id="usuarioModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="usuarioModalTitle">
                        <i class="bi bi-person-plus me-2"></i>Nuevo Usuario
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="form-usuario">
                        <input type="hidden" id="usuario-id">
                        <input type="hidden" id="usuario-mode" value="add">

                        <!-- Informaci√≥n B√°sica -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h6 class="border-bottom pb-2 mb-3">
                                    <i class="bi bi-person-badge me-2"></i>Informaci√≥n B√°sica
                                </h6>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="usuario-nombre" class="form-label">Nombre Completo <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="usuario-nombre" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="usuario-email" class="form-label">Email <span class="text-danger">*</span></label>
                                <input type="email" class="form-control" id="usuario-email" required>
                                <small class="text-muted">Se usar√° para iniciar sesi√≥n</small>
                            </div>
                            <div class="col-md-6 mb-3" id="password-group">
                                <label for="usuario-password" class="form-label">Contrase√±a <span class="text-danger">*</span></label>
                                <div class="input-group">
                                    <input type="password" class="form-control" id="usuario-password" minlength="6">
                                    <button class="btn btn-outline-secondary" type="button" id="toggle-password">
                                        <i class="bi bi-eye"></i>
                                    </button>
                                </div>
                                <small class="text-muted">M√≠nimo 6 caracteres</small>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="usuario-rol" class="form-label">Rol <span class="text-danger">*</span></label>
                                <select class="form-select" id="usuario-rol" required>
                                    <option value="">Seleccionar rol...</option>
                                    <option value="SUPER_ADMIN">Super Administrador</option>
                                    <option value="ADMIN">Administrador</option>
                                    <option value="VENDEDOR">Vendedor</option>
                                    <option value="INVENTARIO">Gesti√≥n de Inventario</option>
                                    <option value="CONTADOR">Contador</option>
                                    <option value="REPARTIDOR">Repartidor</option>
                                    <option value="VISUALIZADOR">Visualizador</option>
                                    <option value="PERSONALIZADO">Personalizado</option>
                                </select>
                            </div>
                        </div>

                        <!-- Descripci√≥n de Roles -->
                        <div class="alert alert-info small mb-4" id="rol-description">
                            <strong>Descripci√≥n del Rol:</strong>
                            <ul class="mb-0 mt-2" id="rol-description-list">
                                <li>Selecciona un rol para ver su descripci√≥n</li>
                            </ul>
                        </div>

                        <!-- Permisos Personalizados -->
                        <div id="permisos-personalizados" style="display: none;">
                            <h6 class="border-bottom pb-2 mb-3">
                                <i class="bi bi-shield-check me-2"></i>Permisos Personalizados
                            </h6>

                            <!-- Dashboard -->
                            <div class="card mb-3">
                                <div class="card-header bg-light py-2">
                                    <div class="form-check">
                                        <input class="form-check-input permiso-grupo" type="checkbox" id="grupo-dashboard" data-grupo="dashboard">
                                        <label class="form-check-label fw-bold" for="grupo-dashboard">
                                            <i class="bi bi-speedometer2 me-2"></i>Dashboard
                                        </label>
                                    </div>
                                </div>
                                <div class="card-body py-2">
                                    <div class="form-check">
                                        <input class="form-check-input permiso-item" type="checkbox" value="dashboard_ver" data-grupo="dashboard">
                                        <label class="form-check-label small">Ver dashboard</label>
                                    </div>
                                </div>
                            </div>

                            <!-- Ventas -->
                            <div class="card mb-3">
                                <div class="card-header bg-light py-2">
                                    <div class="form-check">
                                        <input class="form-check-input permiso-grupo" type="checkbox" id="grupo-ventas" data-grupo="ventas">
                                        <label class="form-check-label fw-bold" for="grupo-ventas">
                                            <i class="bi bi-cart3 me-2"></i>Ventas
                                        </label>
                                    </div>
                                </div>
                                <div class="card-body py-2">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-check"><input class="form-check-input permiso-item" type="checkbox" value="ventas_registrar" data-grupo="ventas"><label class="form-check-label small">Registrar venta</label></div>
                                            <div class="form-check"><input class="form-check-input permiso-item" type="checkbox" value="ventas_ver" data-grupo="ventas"><label class="form-check-label small">Ver ventas</label></div>
                                            <div class="form-check"><input class="form-check-input permiso-item" type="checkbox" value="ventas_editar" data-grupo="ventas"><label class="form-check-label small">Editar ventas</label></div>
                                            <div class="form-check"><input class="form-check-input permiso-item" type="checkbox" value="ventas_eliminar" data-grupo="ventas"><label class="form-check-label small">Eliminar ventas</label></div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-check"><input class="form-check-input permiso-item" type="checkbox" value="pedidos_web_ver" data-grupo="ventas"><label class="form-check-label small">Ver pedidos web</label></div>
                                            <div class="form-check"><input class="form-check-input permiso-item" type="checkbox" value="pedidos_web_gestionar" data-grupo="ventas"><label class="form-check-label small">Gestionar pedidos web</label></div>
                                            <div class="form-check"><input class="form-check-input permiso-item" type="checkbox" value="apartados_ver" data-grupo="ventas"><label class="form-check-label small">Ver apartados</label></div>
                                            <div class="form-check"><input class="form-check-input permiso-item" type="checkbox" value="apartados_gestionar" data-grupo="ventas"><label class="form-check-label small">Gestionar apartados</label></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Inventario -->
                            <div class="card mb-3">
                                <div class="card-header bg-light py-2">
                                    <div class="form-check">
                                        <input class="form-check-input permiso-grupo" type="checkbox" id="grupo-inventario" data-grupo="inventario">
                                        <label class="form-check-label fw-bold" for="grupo-inventario">
                                            <i class="bi bi-box-seam me-2"></i>Inventario
                                        </label>
                                    </div>
                                </div>
                                <div class="card-body py-2">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-check"><input class="form-check-input permiso-item" type="checkbox" value="productos_ver" data-grupo="inventario"><label class="form-check-label small">Ver productos</label></div>
                                            <div class="form-check"><input class="form-check-input permiso-item" type="checkbox" value="productos_crear" data-grupo="inventario"><label class="form-check-label small">Crear productos</label></div>
                                            <div class="form-check"><input class="form-check-input permiso-item" type="checkbox" value="productos_editar" data-grupo="inventario"><label class="form-check-label small">Editar productos</label></div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-check"><input class="form-check-input permiso-item" type="checkbox" value="productos_eliminar" data-grupo="inventario"><label class="form-check-label small">Eliminar productos</label></div>
                                            <div class="form-check"><input class="form-check-input permiso-item" type="checkbox" value="productos_cargue_masivo" data-grupo="inventario"><label class="form-check-label small">Cargue masivo</label></div>
                                            <div class="form-check"><input class="form-check-input permiso-item" type="checkbox" value="categorias_ver" data-grupo="inventario"><label class="form-check-label small">Ver categor√≠as</label></div>
                                            <div class="form-check"><input class="form-check-input permiso-item" type="checkbox" value="categorias_gestionar" data-grupo="inventario"><label class="form-check-label small">Gestionar categor√≠as</label></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Clientes -->
                            <div class="card mb-3">
                                <div class="card-header bg-light py-2">
                                    <div class="form-check">
                                        <input class="form-check-input permiso-grupo" type="checkbox" id="grupo-clientes" data-grupo="clientes">
                                        <label class="form-check-label fw-bold" for="grupo-clientes">
                                            <i class="bi bi-people me-2"></i>Clientes
                                        </label>
                                    </div>
                                </div>
                                <div class="card-body py-2">
                                    <div class="form-check"><input class="form-check-input permiso-item" type="checkbox" value="clientes_ver" data-grupo="clientes"><label class="form-check-label small">Ver clientes</label></div>
                                    <div class="form-check"><input class="form-check-input permiso-item" type="checkbox" value="clientes_gestionar" data-grupo="clientes"><label class="form-check-label small">Gestionar clientes</label></div>
                                </div>
                            </div>

                            <!-- Log√≠stica -->
                            <div class="card mb-3">
                                <div class="card-header bg-light py-2">
                                    <div class="form-check">
                                        <input class="form-check-input permiso-grupo" type="checkbox" id="grupo-logistica" data-grupo="logistica">
                                        <label class="form-check-label fw-bold" for="grupo-logistica">
                                            <i class="bi bi-truck me-2"></i>Log√≠stica
                                        </label>
                                    </div>
                                </div>
                                <div class="card-body py-2">
                                    <div class="form-check"><input class="form-check-input permiso-item" type="checkbox" value="repartidores_ver" data-grupo="logistica"><label class="form-check-label small">Ver repartidores</label></div>
                                    <div class="form-check"><input class="form-check-input permiso-item" type="checkbox" value="repartidores_gestionar" data-grupo="logistica"><label class="form-check-label small">Gestionar repartidores</label></div>
                                    <div class="form-check"><input class="form-check-input permiso-item" type="checkbox" value="promociones_ver" data-grupo="logistica"><label class="form-check-label small">Ver promociones</label></div>
                                    <div class="form-check"><input class="form-check-input permiso-item" type="checkbox" value="promociones_gestionar" data-grupo="logistica"><label class="form-check-label small">Gestionar promociones</label></div>
                                </div>
                            </div>

                            <!-- Finanzas -->
                            <div class="card mb-3">
                                <div class="card-header bg-light py-2">
                                    <div class="form-check">
                                        <input class="form-check-input permiso-grupo" type="checkbox" id="grupo-finanzas" data-grupo="finanzas">
                                        <label class="form-check-label fw-bold" for="grupo-finanzas">
                                            <i class="bi bi-wallet2 me-2"></i>Finanzas
                                        </label>
                                    </div>
                                </div>
                                <div class="card-body py-2">
                                    <div class="form-check"><input class="form-check-input permiso-item" type="checkbox" value="finanzas_ver" data-grupo="finanzas"><label class="form-check-label small">Ver finanzas</label></div>
                                    <div class="form-check"><input class="form-check-input permiso-item" type="checkbox" value="finanzas_gestionar" data-grupo="finanzas"><label class="form-check-label small">Gestionar finanzas</label></div>
                                    <div class="form-check"><input class="form-check-input permiso-item" type="checkbox" value="cierres_caja_ver" data-grupo="finanzas"><label class="form-check-label small">Ver cierres de caja</label></div>
                                    <div class="form-check"><input class="form-check-input permiso-item" type="checkbox" value="cierres_caja_gestionar" data-grupo="finanzas"><label class="form-check-label small">Gestionar cierres de caja</label></div>
                                </div>
                            </div>

                            <!-- Configuraci√≥n -->
                            <div class="card mb-3">
                                <div class="card-header bg-light py-2">
                                    <div class="form-check">
                                        <input class="form-check-input permiso-grupo" type="checkbox" id="grupo-config" data-grupo="config">
                                        <label class="form-check-label fw-bold" for="grupo-config">
                                            <i class="bi bi-gear me-2"></i>Configuraci√≥n
                                        </label>
                                    </div>
                                </div>
                                <div class="card-body py-2">
                                    <div class="form-check"><input class="form-check-input permiso-item" type="checkbox" value="config_ver" data-grupo="config"><label class="form-check-label small">Ver configuraci√≥n</label></div>
                                    <div class="form-check"><input class="form-check-input permiso-item" type="checkbox" value="config_backup" data-grupo="config"><label class="form-check-label small">Realizar backups</label></div>
                                </div>
                            </div>

                            <!-- Usuarios -->
                            <div class="card mb-3">
                                <div class="card-header bg-light py-2">
                                    <div class="form-check">
                                        <input class="form-check-input permiso-grupo" type="checkbox" id="grupo-usuarios" data-grupo="usuarios">
                                        <label class="form-check-label fw-bold" for="grupo-usuarios">
                                            <i class="bi bi-person-lock me-2"></i>Usuarios
                                        </label>
                                    </div>
                                </div>
                                <div class="card-body py-2">
                                    <div class="alert alert-warning small mb-2">
                                        <i class="bi bi-exclamation-triangle me-2"></i>Solo Super Administradores
                                    </div>
                                    <div class="form-check"><input class="form-check-input permiso-item" type="checkbox" value="usuarios_ver" data-grupo="usuarios"><label class="form-check-label small">Ver usuarios</label></div>
                                    <div class="form-check"><input class="form-check-input permiso-item" type="checkbox" value="usuarios_gestionar" data-grupo="usuarios"><label class="form-check-label small">Gestionar usuarios</label></div>
                                </div>
                            </div>
                        </div>

                        <!-- Estado -->
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" id="usuario-activo" checked>
                            <label class="form-check-label" for="usuario-activo">
                                <strong>Usuario Activo</strong>
                                <br><small class="text-muted">Los usuarios inactivos no podr√°n iniciar sesi√≥n</small>
                            </label>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" form="form-usuario" class="btn btn-primary" id="btn-save-usuario">
                        <i class="bi bi-save me-2"></i>Guardar Usuario
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Confirmar Eliminaci√≥n de Usuario -->
    <div class="modal fade" id="deleteUsuarioModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-danger">
                        <i class="bi bi-exclamation-triangle-fill me-2"></i>Confirmar Eliminaci√≥n
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>¬øEst√°s seguro de que deseas eliminar este usuario?</p>
                    <p class="fw-bold" id="delete-usuario-name"></p>
                    <div class="alert alert-danger small">
                        <i class="bi bi-exclamation-circle me-2"></i>
                        Esta acci√≥n no se puede deshacer. El usuario ya no podr√° acceder al sistema.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-danger" id="confirm-delete-usuario">
                        <i class="bi bi-trash me-2"></i>Eliminar Usuario
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Confirmar Eliminaci√≥n de Todos los Pedidos Web -->
    <div class="modal fade" id="deleteAllWebOrdersModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">
                        <i class="bi bi-exclamation-triangle-fill me-2"></i>¬°ADVERTENCIA! Eliminar Todos los Pedidos Web
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-danger">
                        <h6 class="alert-heading"><i class="bi bi-exclamation-octagon me-2"></i>Esta acci√≥n es IRREVERSIBLE</h6>
                        <p class="mb-0">Est√°s a punto de eliminar TODOS los pedidos web del sistema. Esta acci√≥n NO se puede deshacer.</p>
                    </div>
                    <p class="fw-bold mb-2">Se eliminar√°n:</p>
                    <ul class="mb-3">
                        <li>Todos los pedidos pendientes</li>
                        <li>Todos los pedidos procesados</li>
                        <li>Todo el historial de pedidos web</li>
                    </ul>
                    <p class="text-danger fw-bold">¬øEst√°s completamente seguro de que deseas continuar?</p>
                    <div class="form-check mt-3">
                        <input class="form-check-input" type="checkbox" id="confirmDeleteAllWebOrders">
                        <label class="form-check-label fw-bold" for="confirmDeleteAllWebOrders">
                            S√≠, entiendo que esta acci√≥n es irreversible y quiero eliminar todos los pedidos web
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-danger" id="confirm-delete-all-web-orders" disabled>
                        <i class="bi bi-trash3-fill me-2"></i>Eliminar Todos los Pedidos
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- üìö LIBRER√çA JSBARCODE PARA GENERAR C√ìDIGOS DE BARRAS -->
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>

    <!-- üîç SISTEMA DE C√ìDIGOS DE BARRAS -->
    <script src="barcode-system.js"></script>

    <!-- üîê SISTEMA DE AUTENTICACI√ìN Y PERMISOS -->
    <script type="module">
        import AuthManager from './auth.js';
        import { initUsuariosManager } from './usuarios.js';
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBB55I4aWpH5hOtqK6FdNzZCuYCRm1siiI",
            authDomain: "mishell-boutique-admin.firebaseapp.com",
            projectId: "mishell-boutique-admin",
            storageBucket: "mishell-boutique-admin.firebasestorage.app",
            messagingSenderId: "399662956877",
            appId: "1:399662956877:web:084236f5bb3cf6f0a8f704",
            measurementId: "G-TZ3WQ8LSXH"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Initialize Authentication Manager
        const authManager = new AuthManager(app);

        // Initialize authentication and apply permissions
        authManager.init()
            .then((user) => {
                console.log('Usuario autenticado:', user.nombre);

                // Initialize Users Manager
                initUsuariosManager(db, authManager);

                // Expose authManager globally for other scripts to use
                window.authManager = authManager;
            })
            .catch((error) => {
                console.error('Error de autenticaci√≥n:', error);
                // User will be redirected to login by AuthManager
            });
    </script>

    <!-- Estilos para el dropdown de usuario -->
    <style>
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>

    <!-- Script para controlar el dropdown de usuario -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const userProfileBtn = document.getElementById('userProfileBtn');
            const userDropdown = document.getElementById('userDropdown');

            if (userProfileBtn && userDropdown) {
                // Toggle dropdown al hacer clic en el bot√≥n
                userProfileBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const isVisible = userDropdown.style.display === 'block';
                    userDropdown.style.display = isVisible ? 'none' : 'block';
                });

                // Cerrar dropdown al hacer clic fuera
                document.addEventListener('click', function(e) {
                    if (!userProfileBtn.contains(e.target) && !userDropdown.contains(e.target)) {
                        userDropdown.style.display = 'none';
                    }
                });

                // Prevenir que el dropdown se cierre al hacer clic dentro
                userDropdown.addEventListener('click', function(e) {
                    e.stopPropagation();
                });
            }
        });
    </script>

    <footer style="background-color: #f8f9fa; padding: 1rem 0; margin-top: 2rem; border-top: 1px solid #dee2e6;">
        <div class="container">
            <div class="text-center">
                <p class="text-muted small m-0">¬© 2026 Todos los derechos reservados.</p>
                <p class="text-muted small m-0 mt-1">Desarrollado por <a href="https://www.instagram.com/amei_group/" target="_blank" rel="noopener noreferrer" style="color: #0d6efd; text-decoration: none;">amei_group</a></p>
            </div>
        </div>
    </footer>

</body>
</html>
